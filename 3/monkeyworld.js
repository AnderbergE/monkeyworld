var h=void 0,n=!0,q=null,s=!1;function u(){return function(){}}function aa(b){return function(){return this[b]}}function v(b){return function(){return b}}function fa(b,d){function c(){}c.prototype=d.prototype;b.ed=d.prototype;b.prototype=new c}Object.size=function(b){var d=0,c;for(c in b)b.hasOwnProperty(c)&&d++;return d};
var x=new function(){function b(b,c,f){f===h&&(f="");if("evm"!=f&&"sound"!=f){for(var f=f.substr(0,8),f=f.toUpperCase(),a=8-f.length,e=0;e<a;e++)f=" "+f;console.log(b+" "+f+" "+c)}}console.log("Creating Log");this.debug=function(d,c){b("DEBUG  ",d,c)};this.Jb=function(d){b("NOTIFY ",d,"sound")};this.error=function(d,c){b("ERROR  ",d,c)}};Array.prototype.remove=function(b){for(var d=0;d<this.length;d++)this[d]===b&&this.splice(d)};
var y=new function(){function b(b,c,f,a){var e=0,g=0;this.next=function(){var j=b+e*f,o=c+g*a;e=(e+1)%2;0==e&&g++;return{x:j,y:o}}}this.Db=function(b){return!isNaN(b-0)};this.ib=function(b,c,f,a){function e(){var a,b;a===h&&(a=0);b===h&&(b=0);return{x:a,y:b}}return function(a,b,d,c,f){var l=new e;l.x=b.x*a*a*a+d.x*3*a*a*(1-a)+c.x*3*a*(1-a)*(1-a)+f.x*(1-a)*(1-a)*(1-a);l.y=b.y*a*a*a+d.y*3*a*a*(1-a)+c.y*3*a*(1-a)*(1-a)+f.y*(1-a)*(1-a)*(1-a);return l}(0.5,b,c,f,a)};this.g=function(b,c){b.x!=h&&(b.x*=
c);b.y!=h&&(b.y*=c);b.width!=h&&(b.width*=c);b.height!=h&&(b.height*=c);b.fontSize!=h&&(b.fontSize*=c);if(b.scale!=h&&(b.scale.x!=h&&(b.scale.x*=c),b.scale.y!=h))b.scale.y*=c;return b};this.p=function(b,c){return Math.floor(Math.random()*(c-b+1))+b};this.pa=function(b,c){for(var f=0;f<b.length;f++)if(b[f]===c)return n;return s};this.$=function(d,c,f,a){return new b(d,c,f,a)};this.mb=function(b,c,f,a,e,g){5==arguments.length&&(g=s);for(var j=Array(f),o=Array(e),k=0;k<e;k++){for(var i=this.p(0,f-1);this.pa(o,
i);)i=this.p(0,f-1);o.push(i)}for(k=0;k<f;k++)if(this.pa(o,k))j[k]=a;else if(j[k]=this.p(b,c),g)for(;j[k]==a;)j[k]=this.p(b,c);return j}};function ga(){this.D=[];this.fb=function(b,d){var c=d.w.f,f=n,a;for(a in c)0<c[a].W?(c[a].W-=b,d[a]+=c[a].step*b,f=s):d[a]=c[a].to;return f}}
function ha(b,d,c,f){d.w={};var a=d.w;a.f={};for(var e in c){a.f[e]={};a.f[e].to=c[e];if(f.duration!=h){var g=f.duration;y.Db(f.duration)||(f.duration[e]===h&&alert("Not defined duration for "+e),g=f.duration[e]);a.f[e].duration=g;a.f[e].Xa=n}else a.f[e].duration=Math.abs(c[e]-d[e])/f.speed[e],a.f[e].speed=f.speed[e],a.f[e].Xa=s;a.f[e].step=(c[e]-d[e])/a.f[e].duration;a.f[e].W=a.f[e].duration}a.ob=f.onFrame!=h;a.pb=f.F!=h;a.jb=f.onFrame;a.kb=f.F;a.bd=Number.MAX_VALUE;a.Ga=s;b.D.push(d)}
ga.prototype.tick=function(b){for(var d=0;d<this.D.length;d++)if(this.D[d].w.ob&&this.D[d].w.jb(),this.fb(b,this.D[d])){var c=this.D[d];this.D.splice(d,1);c.w.Ga||(c.w.Ga=n,c.w.pb&&c.w.kb())}};var B="Child Play",C="Monkey See",D="Monkey Do",ia="Guardian Angel";Kinetic.Ba=u();Kinetic.Ba.getWidth=u();function M(b){this.C=b;this.on=function(b,c,f){this.s.on(b,c,f===h?this.C:f)};this.off=function(b,c){this.s.off(b,c===h?this.C:c)};this.k=function(b){this.s.k(b===h?this.C:b)};this.b=function(b,c){this.s.b(b,c)};this.za=function(){console.log(this.s.za())};this.M=function(b){this.C=b}}M.prototype.s=new ja;M.prototype.i=new Kinetic.Ba;
function ka(){var b=[];this.va=function(d){b.push(d)};this.Z=function(d){var c=d-1;if(0>c||c>=b.length)throw"MonkeyWorld.NoSuchRoundException ("+d+")";return b[c]}}function la(){var b=s,d=[];this.V=function(){console.log("reportMistake");b=n};this.T=function(){console.log("madeMistake="+b);return b};this.Lb=function(b){d.push(b)};this.ua=function(){d.splice(d.length-1)};this.Ha=function(){return d}}
function pa(){this.va=function(){throw"MonkeyWorld.NoMiniGameResultException";};this.Z=function(){throw"MonkeyWorld.NoMiniGameResultException";}};Kinetic.Aa=function(b){var d=new Kinetic.Group({x:b.x,y:b.y,width:b.width,height:b.height}),c=new Kinetic.Rect({x:0,y:0,width:b.width,height:b.height,fill:"#ccc",strokeWidth:1,stroke:"white"}),f=new Kinetic.Text({text:b.text,fontFamily:"Arial",textFill:"black",fontSize:b.fontSize,x:b.width/2,y:b.height/2,verticalAlign:"middle",align:"center"});d.add(c);d.add(f);d.on("mousedown touchstart",b.callback);return d};var Q=new function(){var b={global:{language:{l:"en"},monkeySeeRounds:{l:1},triesBeforeGuardianAngel:{l:3}},miniGames:{fishingGame:{targetNumber:{l:2},numberCorrect:{l:1},numberOfFish:{l:7},maxNumber:{l:9}},ladder:{targetNumber:{l:-1}}}};this.sa=function(){return b};this.get=function(d){for(var c=b,f=0;f<arguments.length;f++)c=c[arguments[f]];return c.l};this.set=function(d){for(var c=b,f=0;f<arguments.length-1;f++)c=c[arguments[f]];c.l=arguments[arguments.length-1]};this.Qb=function(){var d=JSON.parse($.cookie("monkeyWorldSettings"));
d!==q&&(b=d)};this.Ob=function(d,c){for(var f=d.split("-"),a=b,e=0;e<f.length;e++)a=a[f[e]];a.l=c}};
function qa(){function b(a,e){for(var c in a)if("object"===typeof a[c]&&a[c].l===h)b(a[c],e+"-"+c);else if(a[c].l!=h){var d=$("#"+e+"-"+c).val();Q.Ob(e+"-"+c,d)}}function d(){$("#settings-panel").append('<div id="settings-panel-content">');e=$("#settings-panel-content");e.append("<h1>"+R("SETTINGS_LABEL")+"</h1>");e.append("<form>");var b=a.sa(),d;for(d in b)e.append(f(d,2,"")),e.append(c(b[d],2,d));e.append("<button type=\"button\" onclick=\"window['egame']['hideSettings']()\">"+R("SETTINGS_CANCEL")+
"</button>");e.append("<button type=\"button\" onclick=\"window['egame']['applySettings']();window['egame']['hideSettings']()\">"+R("SETTINGS_APPLY")+"</button>");e.append("</form>");e.append("</div>")}function c(a,b,e){var d;d="<ul>";for(var i in a)if("object"===typeof a[i]&&a[i].l===h)d+=f(i,b+1,e),d+=c(a[i],b+1,e+"-"+i);else{d+="<li>";d+=f(i,b+1,e);var l="",l=l+('<input type="text" id="'+(e+"-"+i)+'" value="'+a[i].l+'" />');d+=l+"</li>"}return d+"</ul>"}function f(a,b,e){var c="",a="SETTINGS_"+
((e===h?"":e+"_")+a).toUpperCase().replace("-","_")+"_LABEL",a=R(a);a!=q&&(c+="<h"+b+">"+a+"</h"+b+">");return c}var a=Q,e=$("#settings-panel-content");this.apply=function(){var c=a.sa(),f;for(f in c)"object"===typeof c[f]&&b(c[f],f);e.remove();d()};this.show=function(){d();$("#settings-panel").show()};this.hide=function(){e.remove();$("#settings-panel").hide()}};var ra={INIT_LOADING_SOUNDS:{sv:"Laddar ner ljud...",en:"Downloading sounds..."},INIT_LOADING_IMAGES:{sv:"Laddar ner bilder...",en:"Downloading images..."},RESTART:{sv:"Starta om",en:"Restart"},SETTINGS:{sv:"Inst\u00e4llningar",en:"Settings"},YAY:{sv:"Hurra!",en:"Yay!"},ARE_YOU_READY_TO_TEACH:{sv:"\u00c4r du redo att l\u00e4ra apan?",en:"Are you ready to teach monkey?"},NO_MY_TURN:{sv:"Gl\u00f6m inte att det \u00e4r MIN tur nu!",en:"Remember it\u2019s MY turn now!"},BUT_YOU_CAN_INTERRUPT:{sv:"Men du kan avbryta mig om jag g\u00f6r fel.",
en:"But you can interrupt me if I'm making a mistake."},MAYBE_THAT_WORKS:{sv:"Okej, vi testar och ser om det \u00e4r r\u00e4tt.",en:"OK, let's see if this works."},WHICH_ONE_DO_YOU_THINK_IT_IS:{sv:"Vilken tror du att det \u00e4r?",en:"Which one do you think it is?"},YES_I_THINK_THAT_ONE_IS_BETTER:{sv:"Ja, det d\u00e4r fungerar nog b\u00e4ttre!",en:"Yes, I think that one is better!"},BETTER_BECAUSE_BIGGER:{sv:"Ja, det verkar vara ett bra val, eftersom den \u00c4R st\u00f6rre!",en:"Yes, that seems to be a good choice because it IS bigger!"},
BETTER_BECAUSE_SMALLER:{sv:"Ja, det verkar vara ett bra val, eftersom den \u00c4R mindre!",en:"Yes, that seems to be a good choice because it IS smaller!"},IM_GOING_TO_PICK_THIS_ONE:{sv:"Okej, f\u00e5r se om den h\u00e4r fungerar. Hmm...",en:"Ok, let's see if this works. Hmm..."},AGENT_PLAY_TOO_LOW:{sv:"Hmm, det gick inte. Jag undrar varf\u00f6r. Jag testar en st\u00f6rre!",en:"Hmm, that didn't work. I wonder why. Let me try a bigger one!"},AGENT_PLAY_TOO_HIGH:{sv:"\u00c5h, nej! Var den f\u00f6r stor?",
en:"Oh no! Was that too big?"},FISHING_CATCH_NUMBER:{sv:"F\u00e5nga nummer %1",en:"Catch number %1"},FISHING_CATCH:{sv:"F\u00e5nga",en:"Catch"},FISHING_FREE_WRONG_ONES:{sv:"Frige fiskarna som \u00e4r fel",en:"Put back the wrong fish"},FISHING_NOT_THIS_ONE:{sv:"Inte den!",en:"Not this one!"},FISHING_THERE_ARE_MORE:{sv:"Det finns mer fiskar att f\u00e5nga. Forts\u00e4tt leta!",en:"There are more fish to catch. Keep looking!"},FISHING_ARE_YOU_SURE:{sv:"\u00c4r du s\u00e4ker?",en:"Are you sure?"},FISHING_COUNT_FISH:{sv:"R\u00e4kna fiskarna!",
en:"Count the fish!"},FISHING_COUNT_TARGET_FISH:{sv:"R\u00e4kna fiskarna med",en:"Count the fish with"},FISHING_ANGEL_CHOOSE_FISH:{sv:"Jag v\u00e4ljer den h\u00e4r fisken eftersom...",en:"I choose this fish, because it..."},FISHING_ANGEL_COUNT:{sv:"Jag v\u00e4ljer den h\u00e4r siffran eftersom...",en:"I choose this number, because..."},LADDER_LOOKS_FUN:{sv:"Det d\u00e4r s\u00e5g kul ut!",en:"That looked fun!"},LADDER_SHOW_ME:{sv:"Visa mig hur man g\u00f6r!",en:"Now show me how to do it!"},LADDER_MY_TURN:{sv:"Okej, nu ska vi se om jag klarar det h\u00e4r sj\u00e4lv!",
en:"Ok, now let's see if I can do this on my own!"},LADDER_IS_IT_RIGHT:{sv:"G\u00f6r jag r\u00e4tt eller fel?",en:"Am I doing it right or wrong?"},LADDER_IT_WAS_RIGHT:{sv:"Ja! Du fick presenten!",en:"Yeah! You got it!"},LADDER_OOPS_TOO_HIGH:{sv:"Oj, kanske tog vi i f\u00f6r mycket!",en:"Oops! Maybe we overdid it!"},LADDER_OOPS_TOO_LOW:{sv:"Hmm... Kanske var det inte tillr\u00e4ckligt!",en:"Hmm... Maybe it wasn't enough!"},LADDER_TRY_A_SMALLER_NUMBER:{sv:"Vi kan v\u00e4l testa en mindre och se vad som h\u00e4nder!",
en:"Let's try a smaller one and see what happens!"},LADDER_TRY_A_BIGGER_NUMBER:{sv:"Vad tror du? Ska vi testa en st\u00f6rre?",en:"What do you think? Shall we try a bigger one?"},LADDER_AGENT_SEE_CORRECT:{sv:"WOO! Tack f\u00f6r hj\u00e4lpen! Vilken fin present!",en:"WOO! Thank you for helping me! What a great surprise!"},LADDER_AGENT_SUGGEST_SOLUTION_1:{sv:"Kanske kan vi f\u00f6rs\u00f6ka med samma siffra p\u00e5",en:"Maybe we should match the number on"},LADDER_AGENT_SUGGEST_SOLUTION_2:{sv:"nummerplattan som vid presenten?",
en:"the number pad to the number by the gift?"},LADDER_PLEASE_HELP_ME:{sv:"Kan du hj\u00e4lpa mig att v\u00e4lja r\u00e4tt?",en:"Can you please help me find the right one?"},BUBBA_HI:{sv:"Hej! Mitt namn \u00e4r Bubba!",en:"Hi, my name is Bubba!"},BUBBA_HERE_TO_HELP:{sv:"Jag ska hj\u00e4lpa dig och apan l\u00e4ngs v\u00e4gen.",en:"I'm here to help you and monkey throughout his journey."},MONKEY_LEARNED_WELL:{sv:"Toppen! Apan l\u00e4rde sig bra!",en:"Great! Monkey learned well!"},MONKEY_DIDNT_LEARN_WELL:{sv:"\u00c5h, nej! Apan l\u00e4rde sig inte riktigt.",
en:"Oh no! Monkey didn't learn well."},LETS_SHOW_HIM_AGAIN:{sv:"Visa honom igen!",en:"Let's show him again!"},THANK_YOU_FOR_HELPING:{sv:"Tack f\u00f6r att du hj\u00e4lpte apan!",en:"Thank you for helping monkey!"},NOW_MONKEY_SHOW_YOU:{sv:"Nu visar apan dig vad den har l\u00e4rt sig!",en:"Now monkey show you what it learned!"},MONKEYS_TURN:{sv:"Apans tur!",en:"Monkey's turn!"},MONKEY_HMM:{sv:"Apan: Hmmm...",en:"Monkey: Hmm..."},FISHING_KEEP_GOING:{sv:"Forts\u00e4tt!",en:"Keep going!"},NUMBER_1:{sv:"nummer 1",
en:"number 1"},NUMBER_2:{sv:"nummer 2",en:"number 2"},NUMBER_3:{sv:"nummer 3",en:"number 3"},NUMBER_4:{sv:"nummer 4",en:"number 4"},NUMBER_5:{sv:"nummer 5",en:"number 5"},NUMBER_6:{sv:"nummer 6",en:"number 6"},NUMBER_7:{sv:"nummer 7",en:"number 7"},NUMBER_8:{sv:"nummer 8",en:"number 8"},NUMBER_9:{sv:"nummer 9",en:"number 9"},NUMBER_10:{sv:"nummer 10",en:"number 10"},SETTINGS_LABEL:{sv:"Inst\u00e4llningar",en:"Settings"},SETTINGS_APPLY:{sv:"Verkst\u00e4ll",en:"Apply"},SETTINGS_SHOW:{sv:"Visa inst\u00e4llningar",
en:"Show settings"},SETTINGS_HIDE:{sv:"G\u00f6m inst\u00e4llningar",en:"Hide settings"},SETTINGS_CANCEL:{sv:"Avbryt",en:"Cancel"},SETTINGS_GLOBAL_LABEL:{sv:"Globala",en:"Global"},SETTINGS_GLOBAL_LANGUAGE_LABEL:{sv:'Spr\u00e5k (kan vara "sv" eller "en" och kr\u00e4ver omstart)',en:'Language (can be "sv" or "en" and requires restart)'},SETTINGS_GLOBAL_MONKEYSEEROUNDS_LABEL:{sv:"Monkey See-rundor",en:"Monkey See rounds"},SETTINGS_GLOBAL_TRIESBEFOREGUARDIANANGEL_LABEL:{sv:"F\u00f6rs\u00f6k innan skydds\u00e4ngel",
en:"Tries before guardian angel"},SETTINGS_MINIGAMES_LABEL:{sv:"Minispel",en:"Mini-games"},SETTINGS_MINIGAMES_FISHINGGAME_LABEL:{sv:"Fiskespel",en:"Fishing Game"},SETTINGS_MINIGAMES_FISHINGGAME_TARGETNUMBER_LABEL:{sv:"M\u00e5lnummer",en:"Target number"},SETTINGS_MINIGAMES_FISHINGGAME_NUMBERCORRECT_LABEL:{sv:"Antal korrekta fiskar",en:"Number of correct fish"},SETTINGS_MINIGAMES_FISHINGGAME_NUMBEROFFISH_LABEL:{sv:"Antal fiskar totalt",en:"Number of fish totally"},SETTINGS_MINIGAMES_FISHINGGAME_MAXNUMBER_LABEL:{sv:"H\u00f6gsta m\u00f6jliga nummer",
en:"Maximum number on fish"},SETTINGS_MINIGAMES_LADDER_LABEL:{sv:"Stegen",en:"The Ladder"},SETTINGS_MINIGAMES_LADDER_TARGETNUMBER_LABEL:{sv:"M\u00e5lnummer",en:"Target number"}};function R(b,d){if(ra[b]===h)return q;for(var c=ra[b][Q.get("global","language")],f=1;f<arguments.length;f++)c=c.replace("%"+f,arguments[f]);return c};function T(b,d,c){this.aa=b;this.ba=d;this.La=c}
var ua=new T("19446__totya__yeah",R("YAY")),va=new T("27882__stickinthemud__bike-horn-double-toot",q),wa=new T("60443__jobro__tada1",q),xa=new T("406__tictacshutup__click-1-d",q,4),ya=new T(q,R("NO_MY_TURN")),za=new T(q,R("BUT_YOU_CAN_INTERRUPT")),Aa=new T(q,R("IM_GOING_TO_PICK_THIS_ONE")),Ba=new T(q,R("YES_I_THINK_THAT_ONE_IS_BETTER")),Ca=new T(q,R("MAYBE_THAT_WORKS")),Fa=new T(q,R("WHICH_ONE_DO_YOU_THINK_IT_IS")),Ga=new T(q,R("BETTER_BECAUSE_BIGGER")),Ha=new T(q,R("BETTER_BECAUSE_SMALLER")),Ia=
new T(q,R("AGENT_PLAY_TOO_LOW")),Ja=new T(q,R("AGENT_PLAY_TOO_HIGH")),Ka=new T(q,R("MONKEY_HMM")),La=new T("51710__bristolstories__u-chimes3_short",q),Ma=new T(q,R("LADDER_LOOKS_FUN")),Na=new T(q,R("LADDER_SHOW_ME")),Oa=new T(q,R("LADDER_MY_TURN")),Pa=new T(q,R("LADDER_IS_IT_RIGHT")),Qa=new T(q,R("LADDER_IT_WAS_RIGHT")),Ra=new T(q,R("LADDER_OOPS_TOO_HIGH")),Sa=new T(q,R("LADDER_OOPS_TOO_LOW")),Ta=new T(q,R("LADDER_TRY_A_SMALLER_NUMBER")),Ua=new T(q,R("LADDER_TRY_A_BIGGER_NUMBER")),Va=new T(q,R("LADDER_AGENT_SEE_CORRECT")),
Wa=new T(q,R("LADDER_PLEASE_HELP_ME")),Xa=new T(q,R("LADDER_AGENT_HELP_IN_INTERRUPT")),Ya=new T(q,R("LADDER_AGENT_SUGGEST_SOLUTION_1")),Za=new T(q,R("LADDER_AGENT_SUGGEST_SOLUTION_2")),$a=new T(q,R("NUMBER_1")),ab=new T(q,R("NUMBER_2")),bb=new T(q,R("NUMBER_3")),cb=new T(q,R("NUMBER_4")),db=new T(q,R("NUMBER_5")),eb=new T(q,R("NUMBER_6")),fb=new T(q,R("NUMBER_7")),gb=new T(q,R("NUMBER_8")),hb=new T(q,R("NUMBER_9")),ib=new T(q,R("NUMBER_10")),jb=new T(q,R("ARE_YOU_READY_TO_TEACH")),kb=new T(q,q,2),
lb=new T(q,R("FISHING_FREE_WRONG_ONES")),mb=new T(q,R("FISHING_CATCH")),nb=new T(q,R("FISHING_NOT_THIS_ONE")),ob=new T(q,R("FISHING_THERE_ARE_MORE")),pb=new T(q,R("FISHING_KEEP_GOING")),qb=new T(q,R("FISHING_ARE_YOU_SURE")),rb=new T(q,R("FISHING_COUNT_FISH")),sb=new T(q,R("FISHING_COUNT_TARGET_FISH")),tb=new T(q,q),ub=new T(q,q),vb=new T(q,q),wb=new T(q,R("FISHING_ANGEL_CHOOSE_FISH")),xb=new T(q,R("FISHING_ANGEL_COUNT")),yb=new T(q,R("BUBBA_HI")),zb=new T(q,R("BUBBA_HERE_TO_HELP")),Ab=new T(q,R("MONKEY_LEARNED_WELL")),
Bb=new T(q,R("MONKEY_DIDNT_LEARN_WELL")),Cb=new T(q,R("LETS_SHOW_HIM_AGAIN")),Db=new T(q,R("THANK_YOU_FOR_HELPING")),Eb=new T(q,R("NOW_MONKEY_SHOW_YOU")),Fb={Tc:ua,ac:va,Qc:wa,ec:xa,Pc:ya,dc:za,tc:Aa,Uc:Ba,Kc:Ca,Sc:Fa,Zb:Ga,$b:Ha,Xb:Ia,Wb:Ja,Mc:Ka,Jc:La,Ac:Ma,Fc:Na,Bc:Oa,yc:Pa,zc:Qa,Cc:Ra,Dc:Sa,Hc:Ta,Gc:Ua,vc:Va,Ec:Wa,uc:Xa,wc:Ya,xc:Za,NUMBER_1:$a,NUMBER_2:ab,NUMBER_3:bb,NUMBER_4:cb,NUMBER_5:db,NUMBER_6:eb,NUMBER_7:fb,NUMBER_8:gb,NUMBER_9:hb,NUMBER_10:ib,Yb:jb,sc:kb,lc:lb,ic:mb,nc:nb,qc:ob,mc:pb,
hc:qb,jc:rb,kc:sb,rc:tb,oc:ub,pc:vb,fc:wb,gc:xb,cc:yb,bc:zb,Nc:Ab,Lc:Bb,Ic:Cb,Rc:Db,Oc:Eb},Gb=q,Gb=[],Hb;for(Hb in Fb){var Ib=Fb[Hb];Fb[Hb].ha=Hb;if(Ib.aa!=q){var Jb={id:Hb,src:"../res/sound/"+Ib.aa+".ogg|../res/sound/"+Ib.aa+".mp3"};Ib.La!=h&&(Jb.data=Ib.La);Gb.push(Jb)}}
var U=new function(){function b(a){for(var b=0;b<f.length;b++)f[b].attrs.y-=30;f.push(a)}var d=q,c=q,f=[];this.Sb=function(a){d=a;c=d.eb};this.play=function(a){x.Jb('"'+a.ba+'"');a.aa!=q&&SoundJS.play(a.ha);var e=R(a.ha);e!=q&&(a.ba=e);if(a.ba!=q){var g=new Kinetic.Text({x:c.getParent().attrs.width/2,y:c.getParent().attrs.height-50,text:a.ba,fontSize:26,fontFamily:"Arial",textFill:"white",fill:"gray",textStroke:"black",align:"center",verticalAlign:"middle",textStrokeWidth:1});b(g);c.add(g);d.U();
setTimeout(function(){c.remove(g);d.U();for(var a=0;a<f.length;a++)f[a]===g&&f.splice(a,1)},3E3)}};this.stop=function(a){SoundJS.stop(a.ha)}};var Nb={monkey:"monkey.png",balloons:"balloons.png",eyeball:"BeOS_Eyeball.png","symbol-stop":"Symbol-Stop.png","symbol-check":"Symbol-Check.png",birdnest:"Birds-Nest-psd47561.png"},V={},Ob=0,Pb=0,Qb;for(Qb in Nb)Ob++;function Rb(b){x.debug("Loading images...","images");var d=0,c=Object.size(Nb),f;for(f in Nb)V[f]=new Image,V[f].onload=function(){++d>=c&&b();Pb=d/Ob},V[f].src="../res/img/"+Nb[f]};function Sb(){var b=1,d=b,c=C,f=[],a=s;this.Vb=function(){d=b=Q.get("global","monkeySeeRounds");Q.get("global","triesBeforeGuardianAngel")};this.Vb();this.Eb=function(){return 1===d};this.va=function(a){f.push(a)};this.Rb=function(a){c=a};this.j=function(){return c};this.V=function(){a=n};this.T=function(){return a}};function Tb(){}Tb.prototype=new M("Player");Tb.prototype.v=u();function Ub(){M.call(this,"Module");var b=new function(){var b=[];this.setTimeout=function(c,f){var a=setTimeout(c,f);b.push(a);return a};this.setInterval=function(c,f){var a=setTimeout(c,f);b.push(a);return a};this.clearTimeout=function(c){b.remove(c);clearTimeout(c)};this.ya=function(){for(var c=0;c<b.length;c++)clearTimeout(b[c]);delete b;b=[]}};this.u=function(){x.debug("Tearing down","Module");b.ya()};this.setTimeout=function(d,c){return b.setTimeout(d,c)};this.setInterval=function(d,c){return b.setInterval(d,
c)};this.clearTimeout=function(d){b.clearTimeout(d)}}fa(Ub,M);function Vb(){var b=this,d=q,c=q;this.B=function(a){d.Lb(a)};this.ua=function(){d.ua()};this.V=function(){d.V()};this.T=function(){return d.T()};this.Z=function(){return d};this.Pa=function(){x.debug("Round done","game");this.b("Game.roundDone");this.b("Game.nextRound");this.c.Gb()};this.play=function(a,b){d=new la;console.log(this.C);c=new a.v[this.C](this,b)};var f=s,a=s;this.ra=function(){f=n;c.Cb();b.c.Ra()};this.Nb=function(){f=s;b.c.Qa();c.Mb()};this.r=function(){return f};this.yb=function(){a=
n;b.c.Ra()};this.zb=function(){a=s;b.c.Qa()};this.m=function(){return a};this.stop=function(){this.b("Game.roundDone")};this.start=u()}Vb.prototype=new Ub;Vb.prototype.onFrame=u();function Wb(){this.play=function(){throw"No implemented mini game";}}Wb.prototype=new Vb;function Xb(){x.debug("Creating MonkeyPlayer","player");var b=this;this.v=u();this.v.Ladder=function(d,c){function f(a){e||(console.log(c),console.log(a),j++,setTimeout(function(){console.log("Picking!");a===g||"incorrect"===c[a]?(console.log("Incorrect Number: "+d.la()),d.ta(d.la())):(console.log("Target Number: "+d.h()),d.ta(d.h()))},2E3))}x.debug("Applying MonkeyPlayer's strategy to the Ladder","player");var a=0,e=s,g=y.p(0,c.length-1);console.log("Intentional: "+g);var j=0;b.on("Ladder.readyToPick",
function(){f(a++)});b.on("Ladder.incorrect",function(){d.r()||(4>j?f(a++):4===j&&!d.m()&&(U.play(Wa),d.yb()))});b.on("Ladder.correct",function(){j=0});this.Cb=function(){x.debug("Interrupting agent","agent");e=n;j=0};this.Mb=function(){x.debug("Resuming agent","agent");e=s};b.on("Ladder.hasTreat",function(){setTimeout(function(){d.Na()},1500)});b.on("Game.stopMiniGame",function(){b.k()})};this.v.FishingGame=function(d,c){function f(){setTimeout(function(){U.play(Ka);setTimeout(function(){var a=c[e++];
d.ia(a);e<c.length&&f()},2E3)},1E3)}function a(){var b=c[e++];e<=c.length&&"FishingGame.catchingDone"!=b&&this.setTimeout(function(){"correct"==b?d.J(d.Ka(),function(){a()}):"incorrect"==b?d.J(d.ub(),function(){a()}):"freeIncorrect"==b?d.ka(d.vb(),function(){a()}):"freeCorrect"==b?d.ka(d.tb(),function(){a()}):x.error("Error when handling happenings (no such happening: "+b+")","monkey")},2E3)}x.debug("Applying MonkeyPlayer's strategy to the FishingGame","player");var e=0;b.on("Game.start",function(){d.ca();
d.Va()});b.on("FishingGame.started",function(){a()});b.on("FishingGame.countingStarted",function(){f()});b.on("Game.tearDown",function(){b.k()})}}Xb.prototype=new Tb;function Yb(){this.M("AngelPlayer");var b=this;x.debug("Creating AngelPlayer","player");this.v=u();this.v.Ladder=u();this.v.FishingGame=function(d){function c(){a<d.Ja()&&(U.play(wb),setTimeout(function(){a++;d.J(d.Ka(),function(){c()})},1E3))}function f(){setTimeout(function(){U.play(xb);setTimeout(function(){d.ia(d.Ja())},1E3)},2E3)}var a=0;x.debug("Applying AngelPlayer's strategy to the FishingGame","player");b.on("Game.start",function(){a=0;d.ca();d.Va()});b.on("FishingGame.started",function(){setTimeout(function(){c()},
2E3)});b.on("FishingGame.countingStarted",function(){f()});b.on("Game.tearDown",function(){b.k()})}}Yb.prototype=new Tb;function Zb(){this.M("GamerPlayer");var b=this;x.debug("Creating GamerPlayer","player");this.v=u();this.v.Ladder=u();this.v.FishingGame=function(){x.debug("Applying GamerPlayer's strategy to the FishingGame","player");b.on("fishinggame.started",function(){x.debug("Starting to think","player");b.b("fishinggame.allowClicks")});b.on("Game.tearDown",function(){b.k()})}}Zb.prototype=new Tb;function Z(){x.debug("Creating ViewModule","object");Ub.call(this);var b=this,d=new function(){var a=[];this.d=function(b){y.pa(a,b)||a.push(b);return Tween.get(b)};this.removeTweens=function(a){Tween.removeTweens(a)};this.ya=function(){for(var b=0;b<a.length;b++)Tween.removeTweens(a[b])}};this.Sa=function(){this.on("Game.stopMiniGame",function(){b.k();b.u!=h&&b.u()})};this.d=function(a){return d.d(a)};this.wa=function(a){d.removeTweens(a)};var c=this.u;this.u=function(){x.debug("Tearing down","ViewModule");
f.hide();c();d.ya()};var f=function(){var a=q;return{hide:function(){a!=q&&(a.setText(""),b.i.U())},show:function(c){a!=q?(a.moveTo(b.i.Y),b.i.U(),a.setText(c),a.setPosition(b.i.attrs.width/2,150*b.i.a)):(a=new Kinetic.Text({x:b.i.attrs.width/2,y:150,text:c,fontSize:26,fontFamily:"Short Stack",textFill:"white",textStroke:"black",align:"center",verticalAlign:"middle",scale:{x:0.001,y:0.001},textStrokeWidth:1}),y.g(a,b.i.a));b.i.Y.add(a);Tween.get(a.attrs.scale).to(y.g({x:2,y:2},b.i.a),1E3).wait(3E3).call(function(){Tween.get(a.attrs.scale).to(y.g({x:1,
y:1},b.i.a),1E3).call(u());Tween.get(a.attrs).to({y:50*b.i.a},1E3).call(function(){a.moveTo(b.i.Ca);b.i.U()})})}}}();this.L=function(a){f.show(a)};this.getStage=aa("i")}fa(Z,Ub);Z.prototype.i=q;function $b(b,d){function c(){a.s.print();i=d===h?new ac:new d;b&&(i instanceof ac?(new bc(i)).Sa():i instanceof cc&&(new dc(i)).Sa(),a.b("Game.miniGameListenersInitiated"));a.b("Game.initiate");k===D?i.play(l,w.Z(p).Ha()):i.play(l);i.start();a.b("Game.start")}function f(a){if(a>Q.get("global","monkeySeeRounds")&&(k===C||k===D))throw"MonkeyWorld.MiniGameRoundOverMaxLimit";if(1>a)throw"MonkeyWorld.MiniGameRoundUnderMinLimit";p=a}var a=this,e=new Wb,g=new pa,j=new Zb,o=new Xb;new Yb;var k=B,i=e,l=j,
p=1,t=s,w=g;b===h&&(b=n);this.on("frame",function(a){i.onFrame(a.frame)});this.Gb=function(){if(i===e)throw"MonkeyWorld.NoActiveMiniGameException";this.b("Game.stopMiniGame");if(k===B)k=C,c();else if(k===C){var a=i.Z();w.va(a);a.T()&&(t=n);p===Q.get("global","monkeySeeRounds")?(f(1),k=D,l=o):f(p+1);c()}else k===D&&(p===Q.get("global","monkeySeeRounds")?(f(1),k=B,l=j):(f(p+1),c()))};this.j=function(){return k};this.R=function(){return p};this.start=function(){w=new ka;l=j;c()};this.stop=function(){a.b("Game.stopMiniGame");
i.stop();delete i;i=e;k=B;f(1);l=j;t=s;w=g;this.b("Game.stop")};this.xa=function(){this.stop();this.start()};this.T=function(){return t};this.Qa=function(){l=o};this.Ra=function(){l=j};this.Kb=function(){return l===j};this.Oa=function(){return l===o};this.Hb=function(){return k===B};this.K=function(){return k===C};this.q=function(){return k===D}}$b.prototype=new M("MonkeyWorld.Game");function ec(b,d,c,f,a){var e=Math.floor(7*Math.random()),g=f,j=a,o=Math.random()*(1-0.7)+0.7,k=2*Math.random()*Math.PI,i=1,l=0.3072*o,p=0.2133*o,t=n;this.toString=function(){return"Fish "+d};var w=Math.random()*(8.0E-5-6.0E-5)+6.0E-5,r=Math.random()*(0.5-0.6)+0.6;this.setX=function(a){g=a};this.setY=function(a){j=a};this.getX=function(){return g};this.getY=function(){return j};this.h=function(){return c};this.getWidth=v(0.3072);this.getHeight=v(0.2133);this.S=function(){return l};this.wb=function(){return p};
this.getScale=function(){return o};this.xb=function(){return e};this.Q=function(){return i};var z=s;this.lb=function(){return t};this.Pb=function(){t=s};this.na=function(){switch(e){case 0:return{x:0.1,y:0};case 1:return{x:0.1,y:0};case 2:return{x:0.1,y:0};case 3:return{x:0.1,y:0};case 4:return{x:0.06,y:0.07};case 5:return{x:0.06,y:0.07};case 6:return{x:0.1,y:0};default:return{x:0,y:0}}};this.oa=function(){z=n};var G=this;this.onFrame=function(c){z||(j=a+0.03*Math.cos(r*(k+2*c.time*Math.PI/3E3)),
g=1==i?g+w*c.timeDiff:g-w*c.timeDiff,b.b("fishinggame.fishmoved",{e:G}))};this.Bb=function(a){i=-1;b.b("fishinggame.fishturnedleft",{e:this});g=a-(g-a);b.b("fishinggame.fishmoved",{e:this})};this.Ab=function(a){i=1;b.b("fishinggame.fishturnedright",{e:this});g=a+(a-g);b.b("fishinggame.fishmoved",{e:this})};var E=s;this.isCaptured=function(){return E};this.capture=function(){E=n};this.qb=function(){z=E=s};b.b("fishinggame.initiatedfish",{e:this})};function ac(){function b(a){a.oa()}function d(){if(k==l||o==g.length){for(var b=0;b<g.length;b++)g[b].h()==i&&g[b].Pb();o==l||e==C||e==D?(o!=l&&a.V(),a.B("FishingGame.catchingDone"),a.b("FishingGame.catchingDone",{callback:function(){a.b("FishingGame.countingStarted")}})):a.b("FishingGame.freeWrongOnes")}}function c(){var b=q;e==B?(b=ob,a.b("FishingGame.inactivity",{Ta:b}),f()):e==C&&(b=pb,a.b("FishingGame.inactivity",{Ta:b}),f())}function f(){E&&!(k==l||o==g.length)&&(H=a.setTimeout(c,5E3))}var a=
this;this.M("FishingGame");var e=a.c.j();x.debug("Applying "+e+" Mode","model");this.toString=v("Fish Tank");for(var g=[],j=[],o=0,k=0,i=Q.get("miniGames","fishingGame","targetNumber"),l=Q.get("miniGames","fishingGame","numberCorrect"),p=Q.get("miniGames","fishingGame","numberOfFish"),t=Q.get("miniGames","fishingGame","maxNumber"),w={"0":{x:0.3,y:0.3},1:{x:0.8,y:0.4},2:{x:0.6,y:0.6},3:{x:1,y:0.65},4:{x:0.4,y:0.2},5:{x:0.1,y:0.5},6:{x:1,y:0.8},7:{x:0.8,y:0.2}},t=y.mb(1,t,p,i,l,n),r=0,z=0;z<p;z++){var G=
w[z%7];g.push(new ec(this.s,r++,t[z],G.x,G.y))}this.onFrame=function(a){for(var b=0;b<g.length;b++){var c=g[b];c.onFrame(a);var d=c.getX();0<c.Q()&&d>=1-c.S()/2?c.Bb(1-c.S()/2):0>c.Q()&&d<=c.S()/2&&c.Ab(c.S()/2)}};this.Wa=function(){for(var b=0;b<g.length;b++)a.b("fishinggame.turnOnClick",{e:g[b]})};this.Ja=function(){return l};this.h=function(){return i};this.ca=function(){x.debug("Turning off clicks","FishingGame");for(var b=0;b<g.length;b++)a.b("fishinggame.turnOffClick",{e:g[b]})};var E=n;this.Va=
function(){E=s};var H=q;this.Da=function(){H!=q&&a.clearTimeout(H)};this.Ma=function(){f()};this.rb=function(){return g};this.cb=function(a){var b=this.Ia();b==j.length?j.push(a):j[b]=a;o++;a.h()==i?(k++,this.B("correct")):this.B("incorrect");a.capture()};this.stop=function(){this.Da()};this.J=function(c,e){a.b("FishingGame.catch",{e:c,oa:b,ja:function(){a.cb(c);d();e!=h&&e()}})};this.ka=function(b,c){b.h()==l?this.B("freeCorrect"):this.B("freeIncorrect");a.b("FishingGame.free",{e:b,ja:function(){for(var a=
0;a<j.length;a++)j[a]===b&&(j[a]=h);o--;b.h()==i&&k--;d();b.qb();c!=h&&c()}})};this.Ia=function(){for(var a=1E3,b=s,c=0;c<j.length;c++)j[c]===h&&c<a&&(a=c,b=n);return b?a:j.length};this.sb=function(){return j};var J=0;this.ia=function(b){if(a.c.j()===C&&0==J||a.c.j()!=C){J++;this.B(b);var c=b==l||a.c.j()!=B;b!=l&&this.V();a.b("FishingGame.counted",{t:b});a.b("FishingGame.countingResult",{Fa:c})}};this.start=function(){f()};this.Ka=function(){for(var a=0;a<g.length;a++){var b=g[a];if(!b.isCaptured()&&
b.h()==i)return b}return q};this.ub=function(){for(var a=0;a<g.length;a++){var b=g[a];if(!b.isCaptured()&&b.h()!=i)return b}return q};this.vb=function(){for(var a=0;a<g.length;a++)if(g[a].isCaptured()&&g[a].h()!=i)return g[a];return q};this.tb=function(){for(var a=0;a<g.length;a++)if(g[a].isCaptured()&&g[a].h()==i)return g[a];return q};this.gb=function(){this.Pa()}}ac.prototype=new Vb;function cc(){function b(a){e.b("Ladder.dropTreat",{callback:function(){e.b("Ladder.birdFlyToNest",{callback:a});e.b("Ladder.hasTreat")},Ea:s})}function d(){j=y.p(1,6);e.b("Ladder.placeTreat",{callback:function(){e.b("Ladder.readyToPick")}})}function c(c){return function(){a();c?(i=n,b(function(){e.B("correct");i=s})):e.b("Ladder.birdFlyToNest",{callback:function(){e.b("Ladder.incorrect");4<=r&&e.b("Ladder.agentSuggestSolution");e.B("incorrect")},Ea:n})}}function f(a){l=n;e.c.q()&&!e.r()?e.b("Ladder.allowInterrupt",
{callback:a}):a()}function a(){l=s;e.c.q()&&e.b("Ladder.disallowInterrupt")}var e=this;this.M("Ladder");var g=Array(6);Q.get("miniGames","ladder","targetNumber");for(var j=y.p(1,6),o=0,k=0,i=s,l=s,p=1,t=0;6>=p;p+=1)g[t++]=p;this.Na=function(){k++;e.b("Ladder.openTreat",{callback:function(){3===k||3<=o&&1<=k?e.b("Ladder.cheer",{callback:function(){e.Pa()}}):d()}})};var w=0,r=0;this.ta=function(a){o++;f(function(){e.b("Ladder.picked",{t:a,Fa:a===j,callback:function(){e.m()?r++:r=0;e.m()&&a===j&&e.zb();
e.b("Ladder.birdFlyToLadder",{t:a,callback:function(){c(a===j)();a<j&&(e.c.q()&&!e.r()&&!e.m())&&e.b("Ladder.agentTooLow");a>j&&(e.c.q()&&!e.r()&&!e.m())&&e.b("Ladder.agentTooHigh");a<j&&(e.c.K()||e.r()||e.m())&&e.b("Ladder.tooLow");a>j&&(e.c.K()||e.r()||e.m())&&e.b("Ladder.tooHigh");a===j&&(e.c.K()||e.r()||e.m())&&e.b("Ladder.justRight")}});a===j&&(a<w&&(e.r()||e.m()))&&e.b("Ladder.betterBecauseSmaller");a===j&&(a>w&&(e.r()||e.m()))&&e.b("Ladder.betterBecauseBigger");a!=j&&(e.r()||e.m())&&e.b("Ladder.hmm");
e.c.q()&&(console.log("lastHelpAttempt = "+a),w=a);var b=e.m()&&a===j;(e.c.q()&&!e.m()||b)&&e.Nb()}})})};this.h=function(){return j};this.la=function(){var a=y.p(0,g.length-1);return g[a]===j?this.la():g[a]};this.ma=function(){return g};var z=this.ra;this.ra=function(){l&&e.c.Oa()?(a(),z(),e.ua(),i||(e.b("Ladder.interrupt"),e.b("Ladder.birdFlyToNest",{callback:u()}))):console.log("Not interruptable")};this.start=function(){e.b("Ladder.start");e.c.K()?e.b("Ladder.introduceAgent",{callback:d}):e.c.q()?
e.b("Ladder.startAgent",{callback:d}):d()}}cc.prototype=new Vb;function fc(){var b={},d=[],c=0;this.za=v("GameEventManager");this.on=function(c,a,d){for(var c=c.split(" "),g=0;g<c.length;g++)c[g]in b||(b[c[g]]=[]),b[c[g]].push(a),a.ea=d,x.debug((d===h?"unnamed":d)+" registerd "+c[g],"evm")};this.off=function(c,a){for(var d=0;d<b[c].length;d++)b[c][d].ea===a&&b[c].splice(d,1);0==b[c].length&&delete b[c]};this.print=function(){console.log("-------EVENT MANAGER STATE-----------------");for(var c in b){console.log("key: "+c);for(var a=0;a<b[c].length;a++)console.log("   "+
b[c][a].ea)}console.log("-------------------------------------------")};this.k=function(f){if(0<c)d.push(f);else{var a=0,e;for(e in b){for(var g=0;g<b[e].length;g++)b[e][g].ea===f&&(b[e].splice(g,1),a++);0==b[e].length&&delete b[e]}x.debug("Forgot "+a+" event registred by "+f,"evm")}};this.b=function(f,a){c++;var e=b[f];if(e!=h)for(var g=0;g<e.length;g++)(0,e[g])(a);c--;if(0==c&&0<d.length){for(g=0;g<d.length;g++)this.k(d[g]);d=[]}}}
function ja(){this.za=v("NoEventManager");this.on=u();this.b=u();this.off=u();this.k=u()};function gc(){this.qa=u();this.start=u();this.u=u();this.onFrame=u();this.Ha=u()};function hc(b,d){function c(a,b){l&&Tween.get(a.attrs).to({y:a.attrs.y-100*b},600).call(function(){c(a,-1*b)})}function f(a,b){j.splice(j.length-1);Tween.get(b.attrs).to({y:300,x:400},1E3).to({alpha:0},500).call(function(){k.attrs.text=++i;Tween.get(k.attrs).to({alpha:1},500).wait(1500).to({alpha:0},500);Tween.get(a.attrs.scale).to({x:1.2*a.attrs.scale.x,y:1.2*a.attrs.scale.y},1E3).wait(500).call(function(){0<j.length&&f(a,j[j.length-1])})})}function a(a,c){a?U.play(Ab):(U.play(Bb),d.Eb()||setTimeout(function(){U.play(Cb)},
1E3));var e=a?V["happy-face"]:V["sad-face"],f=new Kinetic.Image({image:e,x:b.getWidth()/2,y:b.getHeight()/2,centerOffset:{x:e.width/2,y:e.height/2},scale:{x:b.a,y:b.a}});y.g(f,b.a);g.add(f);setTimeout(function(){g.remove(f);c()},4E3)}x.debug("Creating MonkeyWorldView","object");Z.call(this);var e=this;console.log(this);this.C="MonkeyWorldView";var g=b.Y,j=[];this.u=function(){this.k()};console.log(this);this.on("Game.askIfReadyToTeach",u());this.on("Game.introduceBubba",function(a){var c=new Kinetic.Image({image:V.rafiki,
x:b.getWidth()/2,y:b.getHeight()/2,centerOffset:{x:V.rafiki.width/2,y:V.rafiki.height/2}});y.g(c,b.a);g.add(c);U.play(yb);setTimeout(function(){U.play(zb);setTimeout(function(){g.remove(c);a.callback()},2E3)},1E3)});this.on("Game.showHappySystemConfirmation",function(b){a(n,b.callback)});this.on("Game.showSadSystemConfirmation",function(b){a(s,b.callback)});this.on("Game.thankYouForHelpingMonkey",function(a){var c=new Kinetic.Text({fontFamily:"Arial",fontSize:36*b.a,textFill:"white",Ua:"black",text:R("THANK_YOU_FOR_HELPING"),
align:"center",y:b.getHeight()/2,x:b.getWidth()/2});g.add(c);setTimeout(function(){Tween.get(c.attrs).to({x:-300,y:-400,alpha:1},500).call(function(){g.remove(c);a.callback()})},1500)});var o=new Kinetic.Text({fontFamily:"Arial",fontSize:36,textFill:"white",Ua:"black",text:R("INIT_LOADING_SOUNDS"),align:"center",y:b.getHeight()/2+20,x:b.getWidth()/2});this.on("Game.loadingSounds",function(){g.add(o)});this.on("Game.loadingImages",function(){o.setText(R("INIT_LOADING_IMAGES"))});this.on("Game.loadingDone",
function(){g.remove(o)});this.on("Game.updateSoundLoading",function(a){o.setText(R("INIT_LOADING_SOUNDS")+" "+Math.round(100*a.progress)+" %")});this.on("Game.updateImageLoading",function(a){o.setText(R("INIT_LOADING_IMAGES")+" "+Math.round(100*a.progress)+" %")});var k=q,i=0;this.on("Game.eatBananas",function(){e.on("Game.viewTearDown",function(){l=s;e.k("GGV_EATBANANAS");g.remove(a);g.remove(k)},"GGV_EATBANANAS");k=new Kinetic.Text({fontFamily:"Arial",fontSize:72*b.a,textFill:"white",Ua:"black",
text:i,align:"center",y:b.getHeight()/2,x:b.getWidth()/2-b.getWidth()/4,alpha:0});var a=new Kinetic.Image({image:V.monkey,x:b.getWidth()/2,y:b.getHeight()/2,centerOffset:{x:V.monkey.width/2,y:V.monkey.height/2},scale:{x:b.a,y:b.a}});y.g(a,b.a);y.g(k,b.a);g.add(a);g.add(k);c(a,1);0<j.length&&f(a,j[j.length-1])});var l=n;this.on("Game.addBanana",function(a){var c=new Kinetic.Image({image:V["banana-big"],scale:{x:0.001,y:0.001},centerOffset:{x:256,y:256},x:b.attrs.width/2,y:b.attrs.height/2});y.g(c,
b.a);j.push(c);g.add(c);U.play(kb);Tween.get(c.attrs).to({rotation:2*Math.PI},1E3).wait(1500).to({rotation:-Math.PI/2,x:b.attrs.width-50*b.a-48*(a.index-1)*b.a,y:50*b.a},1E3);Tween.get(c.attrs.scale).to({x:2*b.a,y:2*b.a},1E3).wait(1500).to({x:0.125*b.a,y:0.125*b.a},1E3).call(function(){c.attrs.image=V["banana-small"]}).wait(1500).call(function(){console.log("HERE");a!=h&&a.callback!=h&&a.callback()})});this.on("Game.readyToTeach",function(){var a=new Kinetic.Group({x:b.getWidth()/2-200-128,y:300}),
c=new Kinetic.Group({x:b.getWidth()/2+200-128,y:300}),d=new Kinetic.Image({image:V.green}),e=new Kinetic.Image({image:V.red}),f=new Kinetic.Image({image:V.monkey_icon,scale:{x:2,y:2},x:100,y:100}),i=new Kinetic.Image({image:V["person-yes"],x:20,y:25}),j=new Kinetic.Image({image:V["person-no"],x:60,y:55});y.g(d,b.a);y.g(e,b.a);y.g(f,b.a);y.g(i,b.a);y.g(j,b.a);a.add(e);a.add(j);c.add(d);c.add(f);c.add(i);g.add(c);g.add(a);a=new Kinetic.Text({fontSize:48,fontFamily:"Arial",text:R("ARE_YOU_READY_TO_TEACH"),
textFill:"white",align:"center",y:100,x:b.getWidth()/2});g.add(y.g(a,b.a));g.draw()})}fa(hc,Z);(function(b,d,c){var f=new Kinetic.Layer,a=q,e=q,g=q,j=this.s;b.add(f);this.qa=function(){var d=new Kinetic.Rect({width:b.getWidth(),height:b.getHeight(),fill:"white"});f.add(d);e=new Kinetic.Group({x:b.getWidth()/2-200-128,y:300});a=new Kinetic.Group({x:b.getWidth()/2+200-128,y:300});var d=new Kinetic.Image({image:V.green}),j=new Kinetic.Image({image:V.red}),i=new Kinetic.Image({image:V.monkey_icon,scale:{x:2,y:2},x:100,y:100}),l=new Kinetic.Image({image:V["person-yes"],x:20,y:25}),p=new Kinetic.Image({image:V["person-no"],
x:60,y:55});e.add(j);e.add(p);a.add(d);a.add(i);a.add(l);a.on("mousedown touchstart",function(){a.off("mousedown touchstart");e.off("mousedown touchstart");c.dd()});e.on("mousedown touchstart",function(){a.off("mousedown touchstart");e.off("mousedown touchstart");c.cd()});f.add(a);f.add(e);g=new Kinetic.Text({fontSize:48,fontFamily:"Arial",text:R("ARE_YOU_READY_TO_TEACH"),textFill:"black",align:"center",y:100,x:b.getWidth()/2});f.add(g);f.draw()};j.on("frame",function(){f.draw()},"ReadyToTeachView");
j.on("Game.getBanana",function(){Tween.get(a).to({x:-300,y:-300},600);Tween.get(e).to({x:b.getWidth()+300,y:b.getHeight()+300},600);Tween.get(g).to({x:0,y:b.getHeight()+300},600)},"ReadyToTeachView");this.start=function(){U.play(jb)};this.u=function(){b.remove(f);j.k("ReadyToTeachView")}}).prototype=new Z;function bc(b){function d(){A.L(R("FISHING_CATCH_NUMBER",b.h()).toUpperCase());U.play(mb);A.setTimeout(function(){x.debug("Ready to play","view");U.play(Fb["NUMBER_"+b.h()]);A.s.b("FishingGame.started",q)},700)}function c(){A.k("FishingView_ROD");A.k()}function f(){N=new J(30*m.a,"#3333ff","#aaaaff",4,-2*m.a);Da=new J(20*m.a,"blue","white",6,-2*m.a);ca=new J(15*m.a,"#598FD9","#8ED6FF",8,-1*m.a);for(var a=b.rb(),c=0;c<a.length;c++)ma(a[c]);A.Tb(S);A.hb();x.debug("Building stage...","view");a=new Kinetic.Shape({drawFunc:function(){var a=
this.getContext();a.beginPath();a.moveTo(t,r+17*m.a);a.lineTo(t+p,r+17*m.a);a.lineTo(t+p,r+w);a.lineTo(t,r+w);var b=a.createRadialGradient(t+p/2,r,z,t+p/2,r,G);b.addColorStop(1,"#598FD9");b.addColorStop(0,"#8ED6FF");a.fillStyle=b;a.fill();a.closePath();this.fill()}});V.sky.style.width=300*m.a+"px";da=new Kinetic.Image({x:o,y:k,width:i,height:l,image:V.basket});c=new Kinetic.Image({x:t,y:50*m.a,width:p,image:V.sky});O.add(c);S.add(da);O.add(a);K(O,t,t+p,r+w);X(O,t+20,r+w-150);X(O,t+100,r+w-160);X(O,
t+p-130,r+w-140);if(A.c.j()==D&&1<A.c.R()||A.c.j()==ia)da.attrs.x+=na,O.attrs.x+=na,L.attrs.x+=na;sa=new ba(t,r-50*m.a/2,t+p/2,r-50*m.a,0.390625*m.getHeight());Y=new W;Y.start();ca.start();N.start();Da.start();S.add(O);S.draw();A.on("frame",function(a){F.tick(a.frame.timeDiff);L.draw()})}function a(a,c){if(a.lb()){x.debug("Starting to free "+a,"fish");P&&b.ca();var d=I[a];ha(F,d.attrs,{x:t+p/2,y:r,rotation:Math.PI/2},{duration:{x:1E3,y:1E3,rotation:1E3},F:function(){U.play(ub);d.attrs.centerOffset.x=
0;d.attrs.centerOffset.y=0;var e=H(a);ha(F,d.attrs,{x:e.x,y:e.y,rotation:0},{duration:{x:1E3,y:1E3,rotation:1E3},onFrame:u(),F:function(){c();P&&b.Wa()}})}})}else U.play(nb)}function e(){Kb||(Kb=n,x.debug("Tearing down FishingView's layers","view"),m.remove(S),m.remove(L),m.remove(Lb))}function g(a){b.Da();P&&(a.isCaptured()?(b.ka(a,u()),b.Ma()):(x.debug("Starting to catch "+a,"fish"),b.J(a,u())))}function j(a){I[a].on("mousedown touchstart",function(){P&&g(a)})}var o,k,i,l,p,t,w,r,z,G;function E(){O.moveTo(L);
da.moveTo(L);var a=p+t+300*m.a;L.attrs.centerOffset={x:a,y:0};L.attrs.x=a;da.moveToBottom();O.moveToBottom();S.draw();A.d(L.attrs.scale).to({x:0},2E3).call(function(){L.attrs.centerOffset.x=0;L.attrs.x=na;L.attrs.scale.x=0.1;A.d(L.attrs.scale).to({x:1},2E3).call(function(){O.moveTo(S);O.attrs.x=na;S.draw()})})}function H(a){var b={};b.x=a.getX()*p+t;b.y=a.getY()*w+r;return b}function J(a,b,c,d,e){function f(d,g){var N=z-d,k=new Kinetic.$a({G:d,N:j+e,height:a,nb:b,Fb:c});i.add(k);A.d(k.attrs).to({G:p},
1E3*(N/g)).call(function(){i.remove(k)})}function g(){for(var a=N;a<z;a+=2*(d*k/1E3))f(a,d)}var i=new Kinetic.Group({x:t,y:r});L.add(i);var N=60*-m.a,j=20*m.a,k=4E3*m.a,z=p;this.start=function(){g();this.ga=setInterval(function(){f(N,d)},k)};this.stop=function(){clearInterval(this.ga)}}function W(){function a(){var b=y.p(350*m.a,360*m.a),c=y.p(2E4,5E4),d=new Kinetic.Ya({x:y.p(150*m.a,330*m.a),y:b,radius:y.p(3*m.a,6*m.a)});A.d(d.attrs).to({y:360*m.a-b+80*m.a},c).call(function(){L.remove(d)});L.add(d)}
this.start=function(){this.ga=setInterval(a,3E3)};this.stop=function(){clearInterval(this.ga)}}function ba(a,c,d,e,f){function g(a,c){var d=Mb[b.Ia()];d.rotation=2*a.Q()*Math.PI;A.d(I[a].attrs).to(d,1500).call(function(){b.Ma()});A.d(I[a].attrs.centerOffset).to({x:0,y:0},1500);ha(F,o.attrs,{length:f,n:0,o:e},{duration:{length:1E3,n:1E3,o:200},onFrame:u(),F:function(){c();N();P&&b.Wa()}})}function i(a,b){var c=I[a],d=a.na();d.x*=p;d.y*=w;var e=a.Q();c.attrs.centerOffset.y=d.y;c.attrs.x=0<e?c.attrs.x+
d.x:c.attrs.x-d.x;c.attrs.centerOffset.x=d.x;U.play(tb);ha(F,c.attrs,{rotation:-1*e*Math.PI/2},{duration:{rotation:500},onFrame:u(),F:u()});ha(F,o.attrs,{o:r-90*m.a,length:20*m.a},{speed:{o:0.4*m.a,length:0.5*m.a},onFrame:function(){var b=I[a];b.attrs.x=o.attrs.H;b.attrs.y=o.attrs.I;b=b.attrs.y<r;!z&&b&&(U.play(ub),z=n)},F:function(){U.stop(tb);g(a,b)}})}function N(){A.on("frame",function(a){o.attrs.n+=1.0E-4*l*a.frame.timeDiff;o.attrs.n>=t?(l*=-1,o.attrs.n=t):o.attrs.n<=-t&&(l*=-1,o.attrs.n=-t)},
"FishingView_ROD")}function j(a){a=k(a);return Math.atan((o.attrs.A-a.x)/(o.attrs.o-a.y))}function k(a){var b=a.Q(),c=H(a),d={};d.x=c.x+b*a.na().x*p;d.y=c.y+b*a.na().y*w;return d}var z=s,l=1,t=Math.PI/30,o=new Kinetic.Za({strokeWidth:2*m.a,X:a,A:d,da:c,o:e,length:f,n:0});L.add(o);N();this.J=function(a,c,d){A.off("frame","FishingView_ROD");P&&b.ca();z=s;U.play(vb);var e=j(a),f=k(a);ha(F,o.attrs,{n:e,length:Math.sqrt(Math.pow(o.attrs.A-f.x,2)+Math.pow(o.attrs.o-f.y,2))},{duration:{length:500,n:500},
onFrame:function(){e=j(a);var b=k(a),c=o.attrs,b={n:e,length:Math.sqrt(Math.pow(o.attrs.A-b.x,2)+Math.pow(o.attrs.o-b.y,2))},d=c.w,f;for(f in b)d.f[f].to=b[f],d.f[f].Xa?d.f[f].step=(b[f]-c[f])/d.f[f].W:(d.f[f].duration=Math.abs(b[f]-c[f])/d.f[f].speed,d.f[f].step=(b[f]-c[f])/d.f[f].duration,d.f[f].W=d.f[f].duration)},F:function(){d(a);i(a,c)}})}}function ma(a){var b=H(a),b=new Kinetic.Group({x:b.x,y:b.y,width:a.getScale()*a.getWidth()*p,height:a.getScale()*a.getHeight()*w,centerOffset:{x:0,y:0}});
L.add(b);var c=new Kinetic.Image({x:0,y:0,image:V["fish"+a.xb()],width:a.getScale()*a.getWidth()*p,height:a.getScale()*a.getHeight()*w,centerOffset:{x:a.S()*p/2,y:a.wb()*w/2}});c.setScale(-1,1);b.add(c);c=new Kinetic.Text({x:0,y:0,text:a.h(),fontSize:0.046875*m.getWidth(),fontFamily:"Gloria Hallelujah",textFill:"white",align:"center",verticalAlign:"middle",textStroke:"#444",textStrokeWidth:2/1024*m.getWidth()});b.add(c);c.setScale(a.getScale());I[a]=b;oa[a]=c;j(a)}function X(a,b,c){b=new Kinetic.Image({x:b+
64,y:c+64,image:V.plant,width:128,height:128,centerOffset:{x:64,y:64}});a.add(b)}function K(a,b,c,d){var e=new Kinetic.Shape({drawFunc:function(){var a=this.getContext();a.beginPath();a.moveTo(b,d);a.lineTo(c,d);a.lineTo(c,d-50);a.quadraticCurveTo(b,d-50,b,d-80);a.closePath();this.fill()},fill:"#EED6AF"});a.add(e)}this.M("FishingView");var A=this,m=A.i,I={},oa={},F=new ga,sa=q,P=n,Y=q,ca=q,N=q,Da=q;t=0.2783203125*m.getWidth();r=0.1953125*m.getHeight();p=0.390625*m.getWidth();w=580/768*m.getHeight();
z=30*m.a;G=400*m.a;o=0.693359375*m.getWidth();k=50/768*m.getHeight();i=0.263671875*m.getWidth();l=400/768*m.getHeight();for(var na=-240*m.a,Mb={},ta=y.$(o+0.0625*m.getWidth(),k+l-64/768*m.getHeight(),0.1220703125*m.getWidth(),-128/768*m.getHeight()),ea=0;8>ea;ea++)Mb[ea]=ta.next();var Ea=new ic(this,m,A.c),L=new Kinetic.Layer,S=new Kinetic.Layer,O=new Kinetic.Group({x:0,y:0}),da=q,Lb=S;m.add(S);m.add(Lb);m.add(L);var Kb=s;this.on("Game.stopMiniGame",function(){e();Ea.u();c()});this.on("FishingGame.catch",
function(a){sa.J(a.e,a.ja,a.oa)});this.on("FishingGame.free",function(b){a(b.e,b.ja)});this.on("fishinggame.turnOnClick",function(a){j(a.e)});this.on("fishinggame.turnOffClick",function(a){I[a.e].off("mousedown touchstart")});this.on("fishinggame.allowClicks",function(){P=n});this.on("fishinggame.disallowClicks",function(){P=s});this.on("FishingGame.freeWrongOnes",function(){A.L(R("FISHING_FREE_WRONG_ONES").toUpperCase());U.play(lb)});this.on("FishingGame.catchingDone",function(a){P=s;A.L(R("YAY").toUpperCase());
U.play(ua);this.setTimeout(function(){var c=a.callback;A.off("frame");Y.stop();ca.stop();N.stop();Da.stop();e();Ea.qa(b,I);c()},2E3)});Kinetic.$a=function(a){var b=new Kinetic.Shape(a),c=a.height,d=50*m.a;b.drawFunc=function(){var a=this.getContext();a.beginPath();a.moveTo(0,-20*m.a);a.lineTo(p,-20*m.a);a.lineTo(p,20*m.a);a.lineTo(0,20*m.a);a.clip();a.beginPath();a.moveTo(b.attrs.G,b.attrs.N);a.lineTo(b.attrs.G+d,b.attrs.N);a.quadraticCurveTo(Math.floor(b.attrs.G+0.5*d),Math.floor(b.attrs.N-0.5*c),
Math.floor(b.attrs.G+0.75*d),Math.floor(b.attrs.N-c));a.quadraticCurveTo(Math.floor(b.attrs.G+0.5*d),Math.floor(b.attrs.N-0.5*c),Math.floor(b.attrs.G),Math.floor(b.attrs.N));var e=a.createRadialGradient(p/2,0,z,p/2,0,G);e.addColorStop(1,b.attrs.nb);e.addColorStop(0,b.attrs.Fb);a.fillStyle=e;a.fill();a.closePath()};b.strokeWidth=4;return b};Kinetic.Ya=function(a){a.z={};a.z.x=a.radius/2;a.z.y=-a.radius/2;a.z.radius=a.radius/3;var b=new Kinetic.Shape(a);b.drawFunc=function(){var a=this.getContext(),
c=a.createRadialGradient(b.attrs.x,b.attrs.y,b.attrs.radius/2,b.attrs.x,b.attrs.y,b.attrs.radius),d=a.createRadialGradient(b.attrs.x+b.attrs.z.x,b.attrs.y+b.attrs.z.y,b.attrs.z.radius/5,b.attrs.x+b.attrs.z.x,b.attrs.y+b.attrs.z.y,b.attrs.z.radius);a.beginPath();a.arc(Math.floor(b.attrs.x),Math.floor(b.attrs.y),b.attrs.radius,0,2*Math.PI,s);c.addColorStop(0,"rgba(255,255,255,0)");c.addColorStop(1,"rgba(255,255,255,1)");a.fillStyle=c;a.fill();a.beginPath();a.arc(Math.floor(b.attrs.x),Math.floor(b.attrs.y),
b.attrs.radius,0,2*Math.PI,s);d.addColorStop(0,"white");d.addColorStop(1,"rgba(255,255,255,0)");a.fillStyle=d;a.fill();a.closePath();a.beginPath();a.arc(b.attrs.x,b.attrs.y,0.65*b.attrs.radius,Math.PI/2,Math.PI,s);a.lineWidth=2;a.strokeStyle="rgba(255,255,255,0.5)";a.stroke()};return b};Kinetic.Za=function(a){var c=new Kinetic.Shape(a),d=Math.floor(-5/1024*m.getWidth()),e=Math.floor(7/768*m.getHeight()),f=0.018*m.getWidth(),g=15/1024*m.getWidth();c.drawFunc=function(){c.attrs.H=c.attrs.A+c.attrs.length*
Math.sin(c.attrs.n);c.attrs.I=c.attrs.o+c.attrs.length*Math.cos(c.attrs.n);var a=this.getContext(),i=(c.attrs.A+c.attrs.X)/2-20*m.a,N=c.attrs.o-10*m.a,j=(c.attrs.X+i)/2,k=(c.attrs.da+N)/2-5*m.a,z=y.ib({x:c.attrs.X,y:c.attrs.da},{x:j,y:k},{x:i,y:N},{x:c.attrs.A,y:c.attrs.o});a.beginPath();a.strokeStyle="brown";a.moveTo(c.attrs.X,c.attrs.da);a.lineTo(z.x,z.y);a.lineTo(c.attrs.A,c.attrs.o);a.lineWidth=c.attrs.strokeWidth/2;this.stroke();a.beginPath();a.moveTo(c.attrs.A,c.attrs.o);a.strokeStyle="brown";
a.lineTo(c.attrs.H,c.attrs.I-g-0.2*g);this.stroke();a.beginPath();a.strokeStyle="black";a.moveTo(c.attrs.X,c.attrs.da);a.bezierCurveTo(j,k,i,N,c.attrs.A,c.attrs.o);a.lineWidth=c.attrs.strokeWidth;this.stroke();a.beginPath();a.arc(Math.floor(c.attrs.H),Math.floor(c.attrs.I)-0.95*g,0.2*g,Math.PI,0,s);a.lineWidth=2;a.strokeStyle="black";this.stroke();i=a.createRadialGradient(c.attrs.H+0.5*g,c.attrs.I-0.5*g,0.1*g,c.attrs.H,c.attrs.I,g);i.addColorStop(0,"#ff6666");i.addColorStop(0.5,"#ff0000");i.addColorStop(1,
"#cc0000");a.beginPath();a.arc(Math.floor(c.attrs.H),Math.floor(c.attrs.I),g,0,2*Math.PI,s);a.fillStyle=i;a.fill();a.lineWidth=0.5*c.attrs.strokeWidth;a.strokeStyle="#aa0000";a.stroke();a.font=f+"px Arial";a.fillStyle="white";this.fillText(b.h(),Math.floor(c.attrs.H+d),Math.floor(c.attrs.I+e))};return c};this.toString=v("Fish View");this.on("fishinggame.fishmoved",function(a){var a=a.e,b=H(a);I[a].attrs.x=Math.round(b.x);I[a].attrs.y=Math.round(b.y)});this.on("fishinggame.fishturnedleft",function(a){var b=
I[a.e].getScale();I[a.e].setScale(-1*b.x,b.y);oa[a.e].setScale(-1*a.e.getScale(),1*a.e.getScale())});this.on("fishinggame.fishturnedright",function(a){var b=I[a.e].getScale();I[a.e].setScale(-1*b.x,b.y);oa[a.e].setScale(1*a.e.getScale(),1*a.e.getScale())});this.on("FishingGame.inactivity",function(a){U.play(a.Ta)});this.on("Game.initiate",function(){f()});ta=new Kinetic.Layer;ea=new Kinetic.Text({text:"V\u00e4nta...",fontSize:36,fontFamily:"Arial",textFill:"white",x:m.attrs.width/2,y:m.attrs.height/
2,align:"center"});ta.add(ea);ta.P=ea;this.on("Game.roundDone",function(){x.debug("Tearing down view","view");Ea.u();c()});this.on("Game.start",function(){x.debug("Start rolling view...","view");A.c.j()==D&&1===A.c.R()?(A.L(R("MONKEYS_TURN").toUpperCase()),U.play(Eb),A.setTimeout(function(){A.Ib(d);E()},3E3)):d()})}bc.prototype=new jc;function ic(b,d,c){function f(a,b,e){var a=new Kinetic.Group({x:a,y:b}),b=new Kinetic.Rect({width:100*d.a,height:100*d.a}),f=new Kinetic.Text({text:e,fontSize:72*d.a,fontFamily:"Arial",textFill:"red",textStroke:"black",textStrokeWidth:2*d.a});a.add(b);a.add(f);a.Wc=f;a.P=f;if(c.j()==B||c.j()==C)a.on("mousedown touchstart",function(){k.ia(e)});l.add(a);p[e]=a}var a=700*d.a,e=150*d.a,g=100*d.a,j=150*d.a,o={x:200*d.a,y:200*d.a,width:300*d.a,height:500*d.a,stroke:"black",strokeWidth:3*d.a},k=q,i=new Kinetic.Layer,
l=new Kinetic.Layer;d.add(i);d.add(l);var p={};this.qa=function(b,p){k=b;x.debug("Setting up FishCountingView","view");var r=new Kinetic.Rect({x:0,y:0,width:d.attrs.width,height:d.attrs.height,fill:"white"});i.add(r);i.draw();r=new Kinetic.Rect(o);l.add(r);for(var z=k.sb(),G=y.$(o.x+75*d.a,o.y+100*d.a,135*d.a,135*d.a),r=0;r<z.length;r++)if(z[r]!=h){var E=z[r],H=G.next();p[E].attrs.x=H.x;p[E].attrs.y=H.y;l.add(p[E])}z=[1,2,3,4];G=y.$(a,e,g,j);for(r=0;r<z.length;r++)H=G.next(),f(H.x,H.y,z[r]);l.draw();
c.j()==B?U.play(rb):(U.play(sb),setTimeout(function(){U.play(Fb["NUMBER_"+k.h()])},700))};this.u=function(){d.remove(l);d.remove(i)};b.on("FishingGame.countingResult",function(a){a.Fa?(U.play(ua),setTimeout(function(){k.gb()},1500)):U.play(qb)});b.on("FishingGame.counted",function(a){for(var b in p)p[b].P.attrs.textFill="red";p[a.t].P.attrs.textFill="yellow";setTimeout(function(){p[a.t].P.attrs.textFill="red";l.draw()},1500);l.draw()})};function dc(b){function d(){K.on("mousedown touchstart",function(){b.Na()})}function c(){var b=K.getX(),d=K.getY();a.d(K.attrs).to({x:b-5},100).to({x:b+5},100).to({x:b-5},100).to({x:b+5},100).to({x:b-5},100).to({x:b+5},100).to({x:b-5},100).to({x:b+5},100).to({x:b-5},100).to({x:b},100);a.d(K.attrs).to({y:d-5},100).to({y:d+5},100).to({y:d-5},100).to({y:d+5},100).to({y:d-5},100).to({y:d+5},100).to({y:d-5},100).to({y:d+5},100).to({y:d-5},100).to({y:d},100).wait(4E3).call(function(){c()})}function f(b){b===
h&&(b=1);a.d(ba.attrs.scale).to({y:-1*b},500).call(function(){ma&&f(-1*b)})}jc.call(this);x.debug("Creating LadderView","object");this.M("LadderView");var a=this;console.log("Stage");console.log(a);var e=0.4*a.getStage().getWidth(),g=0.45*a.getStage().getWidth(),j={x:800,y:650},o=s,k=q,i=new Kinetic.Layer,l=new Kinetic.Layer;a.getStage().add(i);a.getStage().add(l);var p=a.getStage().getHeight()-100-90,t=a.getStage().getHeight()-100-80,w=0,r={},z={},G=new Kinetic.Group({x:790,y:130}),E=new Kinetic.Circle({radius:50,
fill:"blue"}),H=new Kinetic.Image({image:V.eyeball,width:30,height:30,x:-50,y:-40}),J=new Kinetic.Image({image:V.eyeball,width:30,height:30,x:-30,y:-40}),W=new Kinetic.Shape({drawFunc:function(){var a=this.getContext();a.beginPath();a.moveTo(-48,-20);a.quadraticCurveTo(-68,-30,-78,-10);a.quadraticCurveTo(-48,-10,-48,0);a.closePath();this.fill();this.stroke()},fill:"#FFD700",stroke:"#DAA520",strokeWidth:4}),ba=new Kinetic.Shape({drawFunc:function(){var a=this.getContext();a.beginPath();a.moveTo(0,
0);a.moveTo(30,0);a.quadraticCurveTo(40,80,50,100);a.quadraticCurveTo(40,80,0,0);a.closePath();this.fill()},fill:"#FFD700",stroke:"#DAA520",strokeWidth:4});ba.attrs.scale.y=0.2;G.add(E);G.add(W);G.add(H);G.add(J);G.add(ba);var E=new Kinetic.Image({image:V.birdnest,x:700,y:130,width:180,height:130}),ma=n,X={start:{x:-50,y:-50},end:{x:50,y:50},colorStops:[0,"red",1,"yellow"]},K=q;a.on("Ladder.betterBecauseBigger",function(){U.play(Ga)});a.on("Ladder.betterBecauseSmaller",function(){U.play(Ha)});a.on("Ladder.hmm",
function(){U.play(Ca)});a.on("Ladder.agentSuggestSolution",function(){a.setTimeout(function(){U.play(Ya);a.setTimeout(function(){U.play(Za)},2E3)},2E3)});a.on("Ladder.tooLow",function(){U.play(Sa);setTimeout(function(){U.play(Ua)},2E3)});a.on("Ladder.tooHigh",function(){U.play(Ra);setTimeout(function(){U.play(Ta)},2E3)});a.on("Ladder.justRight",function(){U.play(Qa)});a.on("Ladder.agentTooLow",function(){U.play(Ia)});a.on("Ladder.agentTooHigh",function(){U.play(Ja)});a.on("Ladder.openTreat",function(b){K.off("mousedown touchstart");
a.wa(K.attrs);K.bb.setFill("blue");k.O.attrs.fill=X;i.draw();var c=new Kinetic.Image({x:K.getX()+128,y:K.getY(),image:V.balloons,width:128,height:128,centerOffset:{x:64,y:64},scale:{x:0.1,y:0.1}});l.add(c);a.d(c.attrs.scale).to({x:1,y:1},500).call(function(){a.d(c.attrs).to({y:100},2E3).call(b.callback)});a.c.K()&&U.play(Va)});a.on("Ladder.cheer",function(b){a.L("YAY!");a.setTimeout(b.callback,2E3)});a.on("Ladder.placeTreat",function(c){w++;c=c.callback;K=new Kinetic.Group({x:130,y:200});var d=new Kinetic.Circle({x:100,
y:45,radius:35,fill:"red",stroke:"#440000",strokeWidth:4});K.bb=d;K.add(d);a.d(K.attrs).to({y:z[b.h()].getY()},1E3).call(c);l.add(K);o=n});a.on("Ladder.done",function(){a.L("YAY!")});var A=q;a.on("Ladder.picked",function(c){function d(){U.play(xa);r[c.t].O.Xc=r[c.t].O.attrs.fill;r[c.t].O.setFill("red");k=r[c.t];i.draw();c.callback()}if(a.c.q()&&!b.r()&&!b.m()){var e={x:r[c.t].getX(),y:r[c.t].getY()};U.play(Aa);a.d(A.attrs.points[1]).wait(1500).to(e,3E3).wait(3E3).call(d).wait(1E3).to(j,1E3)}else d()});
a.on("Ladder.birdFlyToLadder",function(b){ma=n;f();a.d(G.attrs).to({x:300,y:z[b.t].getY()},5500).call(b.callback)});a.on("Ladder.birdFlyToNest",function(b){a.d(G.attrs).to({x:790,y:130},3E3).call(function(){k!=q&&(k.O.attrs.fill=X,i.draw());b.Ea&&(o=n);ma=s;a.d(ba.attrs.scale).to({y:0.2},500);b.callback()})});a.on("Ladder.dropTreat",function(b){var e={x:650+75*w,y:t-200},f={x:e.x,y:e.y};e.x+=170;a.d(G.attrs).to(e,2E3).call(function(){a.d(K.attrs).to({x:650+75*w,y:t},500).call(function(){a.c.q()||
(d(),c())})});a.d(K.attrs).to(f,2E3).call(function(){b.callback()})});a.on("frame",function(){l.draw()});this.on("Game.stopMiniGame",function(){x.debug("Tearing down","LadderView");a.getStage().remove(i);a.getStage().remove(l)});a.on("Game.roundDone",this.u);a.on("Ladder.interrupt",function(){a.wa(G.attrs);a.c.q&&(a.wa(A.attrs.points[1]),a.d(A.attrs.points[1]).to(j,1E3).call(function(){U.play(Fa)}))});H=new Kinetic.Rect({fill:{start:{x:0,y:0},end:{x:a.getStage().getWidth(),y:a.getStage().getHeight()},
colorStops:[0,"#87CEFA",0.6,"#87CEFA",1,"#6A5ACD"]},x:0,y:0,width:a.getStage().getWidth(),height:a.getStage().getHeight()});J=new Kinetic.Shape({drawFunc:function(){var b=this.getContext();b.beginPath();b.moveTo(0,a.getStage().getHeight()-100);b.lineTo(e,a.getStage().getHeight()-100);b.quadraticCurveTo(e-80,a.getStage().getHeight()-80,e-100,a.getStage().getHeight());b.lineTo(0,a.getStage().getHeight());b.closePath();this.fill();this.stroke()},fill:"#F4A460",stroke:"#A52A2A",strokeWidth:4});W=new Kinetic.Shape({drawFunc:function(){var b=
this.getContext();b.beginPath();b.moveTo(a.getStage().getWidth(),a.getStage().getHeight()-100);b.lineTo(a.getStage().getWidth()-g,a.getStage().getHeight()-100);b.quadraticCurveTo(a.getStage().getWidth()-g+80,a.getStage().getHeight()-80,a.getStage().getWidth()-g+100,a.getStage().getHeight());b.lineTo(a.getStage().getWidth(),a.getStage().getHeight());b.closePath();this.fill();this.stroke()},fill:"#F4A460",stroke:"#A52A2A",strokeWidth:4});i.add(H);i.add(J);i.add(W);i.add(E);var m=new Kinetic.Image({image:V["symbol-stop"],
x:750,y:700,centerOffset:{x:64,y:64},alpha:0}),I=new Kinetic.Image({image:V["symbol-check"],x:900,y:700,centerOffset:{x:64,y:64},alpha:0});l.add(m);l.add(I);a.on("Ladder.introduceAgent",function(b){U.play(Ma);a.setTimeout(function(){U.play(Na);a.setTimeout(function(){b.callback()},2E3)},2E3)});a.on("Ladder.startAgent",function(b){U.play(Oa);a.setTimeout(function(){U.play(Pa);a.setTimeout(function(){b.callback();a.d(m.attrs).to({alpha:1},1E3);a.d(I.attrs).to({alpha:1},1E3)},2E3)},2E3)});a.on("Ladder.allowInterrupt",
function(c){m.on("mousedown touchstart",function(){a.d(m.attrs).to({rotation:8*Math.PI},1200).to({rotation:0});U.play(va);b.ra()});I.on("mousedown touchstart",function(){a.d(I.attrs).to({rotation:8*Math.PI},1200).to({rotation:0});U.play(wa)});c.callback()});a.on("Ladder.helpAgent",function(){o=n});a.on("Ladder.disallowInterrupt",function(){m.off("mousedown touchstart");I.off("mousedown touchstart")});for(E=0;E<b.ma().length;E++){var H=b.ma()[E],J=p,J=J-90*E,J=new Kinetic.Group({x:130,y:J}),W=new Kinetic.Polygon({points:[0,
0,120,0,110,90,10,90],fill:"#A52A2A",stroke:"#5C4033",strokeWidth:5}),oa=new Kinetic.Text({text:H,y:45,x:15,height:90,fontSize:56,fontFamily:"Doppio One",textFill:"white",verticalAlign:"middle",textStroke:"#5C4033",textStrokeWidth:2});J.add(W);J.add(oa);z[H]=J;i.add(J)}var F=p-90*(b.ma().length-1),p=new Kinetic.Shape({drawFunc:function(){var a=this.getContext();a.beginPath();a.moveTo(200,F);a.bezierCurveTo(150,F-60,100,F-90,-50,F+80);a.bezierCurveTo(130,F-20,150,F-30,190,F+10);a.bezierCurveTo(150,
F-60,100,F-150,-50,F-180);a.bezierCurveTo(130,F-150,150,F-60,190,F-10);a.bezierCurveTo(250,F-60,300,F-90,450,F+80);a.bezierCurveTo(270,F-20,250,F-30,210,F+10);a.closePath();this.fill();this.stroke()},fill:"#556B2F",stroke:"#006400",strokeWidth:4});i.add(p);l.add(G);for(var sa=y.$(724,300,120,120),P=s,E=1;6>=E;E++)(function(c){var d=sa.next(),d=new Kinetic.Group(d),e=new Kinetic.Rect({width:100,height:100,fill:X,cornerRadius:10,strokeWidth:4,stroke:"orange",centerOffset:{x:50,y:50}});d.add(e);d.O=
e;e=new Kinetic.Text({text:c,fontSize:60,fontFamily:"Nunito",textFill:"orange",verticalAlign:"middle",align:"center",textStroke:"red",textStrokeWidth:1,x:50,y:50,centerOffset:{x:50,y:50}});d.P=e;d.add(e);d.on("mousedown touchstart",function(){o&&a.c.Kb()?(o=s,b.ta(c)):a.c.Oa()&&!P&&(P=n,U.play(ya),setTimeout(function(){U.play(za);setTimeout(function(){P=s},2E3)},2E3))});r[c]=d;i.add(d)})(E);var Y=new Kinetic.Image({image:V.monkey,x:a.getStage().getWidth()+10,y:a.getStage().getHeight()-100-V.monkey.height});
l.add(Y);a.c.q()&&(A=new Kinetic.Line({points:[660,570,j.x,j.y],stroke:"brown",strokeWidth:2,lineCap:"round"}),l.add(A));if(a.c.Hb()){var ca=function(){a.setTimeout(function(){a.d(Y.attrs).to({x:a.getStage().getWidth()-100,rotation:-Math.PI/5},1E3).wait(2E3).to({x:a.getStage().getWidth()+10},1E3).call(function(){ca()})},2E3)};ca()}else(a.c.K()||a.c.q())&&Y.setX(a.getStage().getWidth()-500);i.draw()}fa(dc,jc);function jc(){function b(a){r++;3==r&&(a(),f.draw(),c.k("GameView"))}function d(a){U.play(La);c.on("frame",function(){f.draw()},"GameView");c.d(o.attrs).to(t,2E3).call(function(){b(a)});c.d(e.attrs).to(p,2E3).call(function(){b(a)});c.d(g.attrs).to(l,2E3).call(function(){b(a)})}Z.call(this);var c=this,f=new Kinetic.Layer,a=q,e=q,g=q,j=q,o=q,k=q,i=q,l=q,p=q,t=q,w=q,r=0;this.Tb=function(a){f=a};this.Ib=function(a){d(a)};this.hb=function(){r=0;var b=f.getStage();k={x:20,y:20,width:220,height:730,fill:"white",
alpha:0.2};i={x:260,y:20,width:740,height:730,fill:"white",alpha:0.8};l={y:i.y,alpha:0.2,x:i.x+520,width:220,height:i.height,fill:i.fill};p={alpha:0.8,width:740,y:k.y,x:k.x,height:k.height,fill:k.fill};t={x:740+k.x-175,y:540};w={x:60,y:540};y.g(k,b.a);y.g(i,b.a);y.g(l,b.a);y.g(p,b.a);y.g(t,b.a);y.g(w,b.a);b=f.getStage();a=new Kinetic.Rect({x:0,y:0,width:b.getWidth(),height:b.getHeight()});f.add(a);if(c.c.j()==C||c.c.j()==D){var b=f.getStage(),d=c.c.j(),E=d==D&&1<c.c.R()?t:w;e=new Kinetic.Rect(d==
D&&1<c.c.R()?p:k);o=new Kinetic.Image({x:E.x,y:E.y,scale:{x:1*b.a,y:1*b.a},width:V.monkey.width,height:V.monkey.height,image:V.monkey});f.add(e);f.add(o)}c.c.j()==ia&&(b=f.getStage(),d=p,d=new Kinetic.Rect({x:d.x,y:d.y,width:d.width,height:d.height,fill:d.fill,alpha:d.alpha}),b=new Kinetic.Image(y.g({x:500,y:450,image:V.rafiki,width:200,height:280},b.a)),f.add(d),f.add(b));b=f.getStage();d=c.c.j();g=new Kinetic.Rect(d==D&&1<c.c.R()||d==ia?l:i);j=new Kinetic.Image({x:i.x+i.width-210*b.a,y:i.y+i.height-
220*b.a,scale:{x:0.8*b.a,y:0.8*b.a},width:V.avatar.width,height:V.avatar.height,image:V.avatar});f.add(g);f.add(j)}}fa(jc,Z);SoundJS.fd=u();var kc=q;window.egame=q;window.onload=function(){kc=new lc;window.egame=kc};WebFontConfig={google:{families:["Nunito::latin","Doppio+One::latin"]}};var mc=document.createElement("script");mc.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";mc.type="text/javascript";mc.async="true";var nc=document.getElementsByTagName("script")[0];nc.parentNode.insertBefore(mc,nc);
function lc(){var b=new Sb,d=new qa;Q.Qb();this.applySettings=function(){d.apply();$.cookie("monkeyWorldSettings",JSON.stringify(Q.sa()))};this.hideSettings=function(){d.hide()};this.showSettings=function(){d.show()};var c=new Kinetic.Stage({container:"container",width:1024,height:768});console.log("defined stage");c.a=c.getWidth()/1024;var f=new Kinetic.Layer,a=new Kinetic.Layer,e=new Kinetic.Layer;c.add(f);c.add(a);c.add(e);c.ab=f;c.Y=a;c.Ca=e;c.eb=a;c.$c=aa("Y");c.Zc=aa("ab");c.ad=aa("Ca");c.fa=
s;c.Yc=0;c.Vc=0;c.U=function(){c.fa=n};var g=q,j=q,o=this;(function(){g!=q&&a.remove(g);j!=q&&a.remove(j);a.add(g=new Kinetic.Aa({x:c.getWidth()-100*c.a,y:3,width:100*c.a,height:20*c.a,fontSize:11*c.a,text:R("SETTINGS"),callback:function(){o.showSettings()}}));a.add(j=new Kinetic.Aa({x:c.getWidth()-203*c.a,y:3,width:100*c.a,height:20*c.a,fontSize:11*c.a,text:R("RESTART"),callback:function(){o.xa()}}))})();U.Sb(c);var k=new fc;M.prototype.s=k;Z.prototype.i=c;dc.prototype.i=c;dc.prototype.s=k;console.log("set stage");
var i=new $b(n,cc);M.prototype.c=i;dc.prototype.c=i;new hc(c,b);var l=new gc,p=function(){var b=0,c=new Kinetic.Text({text:"",fontFamily:"Arial",textFill:"black",textStroke:"white",textStrokeWidth:1,fontSize:18,x:0,y:0});a.add(c);return{Ub:function(a){if(0==b||10<a.time-b)c.setText("FPS: "+Math.round(1E3/a.timeDiff)),b=a.time}}}();c.onFrame(function(b){p.Ub(b);k.b("frame",{frame:b});l.onFrame(b);a.draw();c.fa&&(e.draw(),c.fa=s);Tween.tick(b.timeDiff,s)});c.start();k.on("Game.miniGameListenersInitiated",
function(){a.moveToTop();e.moveToTop()},"game");k.b("Game.loadingSounds");var t=q,w=q;x.debug("Loading sounds...","Game");var r=new PreloadJS(s);r.onComplete=function(){clearInterval(t);w=setInterval(function(){k.b("Game.updateImageLoading",{progress:Pb})},50);x.debug("Sounds loaded.","game");k.b("Game.loadingImages");Rb(function(){k.b("Game.loadingDone");clearInterval(w);i.start()})};r.installPlugin(SoundJS);t=setInterval(function(){k.b("Game.updateSoundLoading",{progress:r.progress})},50);r.loadManifest(Gb);
k.on("Game.setMode",function(a){b.Rb(a.mode)},"game");k.on("Game.nextRound",u(),"game");this.xa=function(){i.xa()}};