function v(){return function(){}};function B(b,g,a,e){var h=Math.floor(2*Math.random()),d=a,m=e,k=Math.random()*(1-0.7)+0.7,o=E++,y=2*Math.random()*Math.PI,w=1,z=128*k,A=128*k;this.toString=function(){return"Fish "+o};b.u(this);var x=Math.random()*(0.04-0.03)+0.03,q=Math.random()*(0.5-0.6)+0.6;this.q=function(){return d};this.s=function(){return m};this.L=function(){return g};this.j=function(){return z};this.z=function(){return A};this.getScale=function(){return k};this.M=function(){return h};this.i=function(){return w};this.k=function(){switch(h){case 0:return{x:50,
y:0};case 1:return{x:50,y:0};default:return{x:0,y:0}}};this.P=function(){b.Y(this)};this.onFrame=v();this.t=function(a){a instanceof F&&(m=e+15*Math.cos(q*(y+2*a.frame.time*Math.PI/3E3)),d=1==w?d+x*a.frame.timeDiff:d-x*a.frame.timeDiff,b.g(new I(this)))};this.O=function(a){w=-1;b.g(new J(this));d=a-(d-a);b.g(new I(this))};this.N=function(a){w=1;b.g(new K(this));d=a+(a-d);b.g(new I(this))};this.J=v();b.g(new M({b:this,G:this.J}))};function N(b){this.toString=function(){return"Fish Tank"};var g=[],a=[],e=0;b.u(this);this.l=function(a){for(var d=a.R,a=a.S,e={"0":{x:150,y:200},1:{x:400,y:250},2:{x:300,y:370},3:{x:500,y:490},4:{x:200,y:125}},k=0;k<a;k++){var o=e[k%5];g.push(new B(b,Math.floor(Math.random()*(d+1)),o.x,o.y))}return{width:625,height:600}};this.t=function(a){if(a instanceof F)for(a=0;a<g.length;a++){var d=g[a],b=d.q();0<d.i()&&b>=625-d.j()/2?d.O(625-d.j()/2):0>d.i()&&b<=d.j()/2&&d.N(d.j()/2)}};this.U=function(b){console.log("Put fish "+
b+" in basket.");for(var d=0;d<g.length;d++)g[d]===b&&g.splice(d,1);a.push(b);e++};this.K=function(){return e}};function O(){var b=[];this.u=function(g){this.log("EVMAN: Register "+g);b.push(g)};this.Y=function(g){for(var a=0;a<b.length;a++)b[a]===g&&b.splice(a,1)};this.g=function(g){for(var a=0;a<b.length;a++)b[a].t(g)};this.log=function(b){console.log(b)}}function F(b){this.frame=b}function M(b){this.v=b}function I(b){this.b=b}function J(b){this.b=b}function K(b){this.b=b};window.onload=function(){new P};function P(){var b=new O,g=new Kinetic.Stage("container",1024,768);soundManager.onready(function(){console.log("SOUND: SoundManager2 done, starting rest of game...");var a=N,e=new Q(b,g),a=new R(b,e,e.l,e.start,a);e.T(a,a.l)})};function R(b,g,a,e,h){var d={R:9,S:5};this.l=function(){b.log("MODEL: Creating model...");var m=new h(b);b.log("MODEL: Initiating model...");var k=m.l(d);a.call(g,k,m);e.call(g)}};var E=0;Object.size=function(b){var g=0,a;for(a in b)b.hasOwnProperty(a)&&g++;return g};function S(){this.h=[];this.F=function(b,g){var a=g.f.a,e=!0,h;for(h in a)0<a[h].o?(a[h].o-=b,g[h]+=a[h].step*b,e=!1):g[h]=a[h].B;return e}}
function T(b,g,a,e){g.f={};var h=g.f;h.a={};for(var d in a)h.a[d]={},h.a[d].B=a[d],void 0!==e.duration&&void 0!=e.duration[d]?(h.a[d].duration=e.duration[d],h.a[d].C=!0):(h.a[d].duration=Math.abs(a[d]-g[d])/e.speed[d],h.a[d].speed=e.speed[d],h.a[d].C=!1),h.a[d].step=(a[d]-g[d])/h.a[d].duration,h.a[d].o=h.a[d].duration;h.H=e.onFrame;h.I=e.m;h.ca=Number.MAX_VALUE;h.w=!1;b.h.push(g)};function Q(b,g){var a,e,h,d,m,k;function o(a,b){function d(){console.log("FISH: Starting to catch "+a);L.Q(a);b.call(a)}var c=new Kinetic.Group({x:a.q(),y:a.s(),width:128*a.getScale(),height:128*a.getScale()});q.add(c);var f=new Kinetic.Image({x:-a.j()/2,y:-a.z()/2,image:i["fish"+a.M()],width:128*a.getScale(),height:128*a.getScale(),centerOffset:{x:a.j()/2,y:a.z()/2}});f.setScale(-1,1);c.add(f);f=new Kinetic.Text({x:0,y:0,text:a.L(),fontSize:48,fontFamily:"Comic Sans MS",textFill:"white",align:"center",
verticalAlign:"middle",textStroke:"#444"});c.add(f);f.setScale(a.getScale());c.on("mousedown",d);c.on("touchstart",d);n[a]=c;C[a]=f}function y(a,b,d){b=new Kinetic.Image({x:b,y:d,image:i.plant,width:128,height:128,centerOffset:{x:64,y:64}});a.add(b);a.draw()}function w(a,b,d,c){var f=new Kinetic.Shape({drawFunc:function(){var a=this.getContext();a.beginPath();a.moveTo(b,c);a.lineTo(d,c);a.lineTo(d,c-50);a.quadraticCurveTo(b,c-50,b,c-80);a.closePath();this.fillStroke()},fill:"#EED6AF",stroke:"#CDBA96",
strokeWidth:4});a.add(f)}function z(a){U.V(a);s.g(new F(a));L.draw(a);for(var b=p,a=a.timeDiff,d=0;d<b.h.length;d++)if(b.h[d].f.H(),b.F(a,b.h[d])){var c=b.h[d];b.h.splice(d,1);c.f.w||(c.f.w=!0,c.f.I())}q.draw()}function A(a,b){l.p.text="H\u00e4mtar ljud";l.draw();s.log("VIEW: Loading sounds...");var g=0,c=Object.size(h),f;for(f in h){var e=soundManager.createSound({id:f,url:d+"/"+h[f],autoLoad:!0,autoPlay:!1,onload:function(d){d&&++g==c&&(x(a,b),l.p.text="")}});t[f]=e}}function x(a,b){l.p.text="H\u00e4mtar bilder";
l.draw();s.log("VIEW: Loading images...");var d=0,c=Object.size(m),f;for(f in m)i[f]=new Image,i[f].onload=function(){++d>=c&&(b.call(a),l.p.text="")},i[f].src=k+"/"+m[f]}k="../res/img";m={$:"fish/0.png",aa:"fish/1.png",Z:"bambu.png",da:"plant.png",ea:"sky.png"};d="../res/sound";h={D:"34968__mike-campbell__f-s-1-fishing-reel.wav",W:"water_movement_fast_002.wav",X:"60009__qubodup__swosh-22.wav"};a=100;e=150;var q=new Kinetic.Layer({x:a,y:e}),r=new Kinetic.Layer,D=new Kinetic.Layer,j=new Kinetic.Layer,
u=new Kinetic.Layer,G=new Kinetic.Layer;g.add(D);g.add(u);g.add(q);g.add(r);g.add(j);g.add(G);var L=function(b){function d(a){a=g(a);return Math.atan((c.e.x-a.x)/(c.e.y-a.y))}function g(c){var b=c.i();return{x:c.q()+a+b*c.k().x,y:c.s()+e+b*c.k().y}}var c={e:{x:(2*a+625)/2,y:75},length:300,d:0,n:-1,r:Math.PI/30,speed:1.0E-4,c:null,state:0,ba:{x:(2*a+625)/2,y:375},end:{x:(2*a+625)/2,y:375}};return{draw:function(f){var h=c.d;switch(c.state){case 3:c.A=!1;t.X.play();var h=d(c.c),i=g(c.c);T(p,c,{d:h,length:Math.sqrt(Math.pow(c.e.x-
i.x,2)+Math.pow(c.e.y-i.y,2))},{duration:{length:500,d:500},onFrame:function(){h=d(c.c);var a=g(c.c),b=c,a={d:h,length:Math.sqrt(Math.pow(c.e.x-a.x,2)+Math.pow(c.e.y-a.y,2))},f=b.f,e;for(e in a)f.a[e].B=a[e],f.a[e].C?f.a[e].step=(a[e]-b[e])/f.a[e].o:(f.a[e].duration=Math.abs(a[e]-b[e])/f.a[e].speed,f.a[e].step=(a[e]-b[e])/f.a[e].duration,f.a[e].o=f.a[e].duration)},m:function(){c.c.P();c.state=1}});c.state=4;case 0:h=c.d;c.d+=c.n*c.speed*f.timeDiff;c.d>=c.r?(c.n*=-1,c.d=c.r):c.d<=-c.r&&(c.n*=-1,c.d=
-c.r);break;case 1:var j=c.c,f=n[c.c],i=j.k(),k=j.i();f.centerOffset.y=i.y;0<k||(f.x-=2*i.x);f.centerOffset.x=i.x;f.centerOffset.y=i.y;t.D.play();T(p,f,{rotation:-1*k*Math.PI/2},{duration:{rotation:1E3},onFrame:v(),m:v()});T(p,c,{y:e-120,length:20},{speed:{y:1,length:0.5},onFrame:function(){var b=n[c.c],d=j.k(),f=j.i();b.x=c.end.x-a-d.x;b.y=c.end.y-e-f*d.y;if(!c.A&&b.y<e-100){t.W.play();c.A=true}},m:function(){t.D.stop();c.state=2}});c.state=4;break;case 2:f=V[H.K()],f.rotation=-2*Math.PI,0>c.c.i()&&
(f.x-=2*c.c.k().x,f.rotation=2*Math.PI),T(p,n[c.c],f,{duration:{x:1E3,y:1E3,rotation:1E3},onFrame:v(),m:function(){H.U(c.c)}}),T(p,c,{length:200,d:0,y:75},{duration:{length:1E3,d:1E3,y:200},onFrame:v(),m:function(){c.state=0}}),c.state=4}c.end.x=c.e.x+c.length*Math.sin(h);c.end.y=c.e.y+c.length*Math.cos(h);f=b.getContext();b.clear();f.beginPath();f.strokeStyle="black";f.moveTo(a,125);f.lineTo(c.e.x,c.e.y);f.stroke();f.closePath();f.beginPath();f.moveTo(c.e.x,c.e.y);f.lineTo(c.end.x,c.end.y);f.strokeStyle=
"brown";f.lineWidth=2;f.stroke();f.closePath()},Q:function(a){c.c=a;c.state=3}}}(r),i={},t={},n={},C={},H=null,p=new S,V={6:{x:825,y:0},4:{x:700,y:25},5:{x:825,y:25},2:{x:700,y:153},3:{x:825,y:153},"0":{x:700,y:281},1:{x:825,y:281}};this.toString=function(){return"Fish View"};this.t=function(a){if(a instanceof M)o(a.v.b,a.v.G);else if(a instanceof I)a=a.b,n[a].x=Math.round(a.q()),n[a].y=Math.round(a.s());else if(a instanceof J){var b=n[a.b].getScale();n[a.b].setScale(-1*b.x,b.y);C[a.b].setScale(-1*
a.b.getScale(),1*a.b.getScale())}else a instanceof K&&(b=n[a.b].getScale(),n[a.b].setScale(-1*b.x,b.y),C[a.b].setScale(1*a.b.getScale(),1*a.b.getScale()))};var s=b;s.u(this);this.l=function(b,d){H=d;s.log("VIEW: Building stage...");var h=new Kinetic.Rect({x:0,y:2,width:g.width,height:g.height,fill:"white"}),c=new Kinetic.Rect({x:a,y:e+20,width:625,height:580,fill:"#00D2FF",stroke:"#436EEE",strokeWidth:4}),f=new Kinetic.Shape({drawFunc:function(){var b=this.getContext();b.beginPath();b.moveTo(a+0,
e);b.lineTo(a+625-0,e);b.lineTo(a+625,e+20);b.lineTo(a,e+20);b.closePath();this.fillStroke()},fill:"#00FFFF",alpha:1}),k=new Kinetic.Shape({drawFunc:function(){var b=this.getContext();b.beginPath();b.moveTo(a+0,e+10);b.lineTo(a+625-0,e+10);b.lineTo(a+625,e+20);b.lineTo(a,e+20);b.closePath();this.fillStroke()},fill:"#00FFFF",stroke:"#00FFFF",strokeWidth:0,alpha:0.5});i.sky.style.width="300px";var l=new Kinetic.Image({x:a,y:20,image:i.sky}),m=new Kinetic.Image({x:a-10,y:20,image:i.bambu}),n=new Kinetic.Image({x:a+
625-10,y:20,image:i.bambu}),o=new Kinetic.Image({x:1004,y:20,image:i.bambu}),p=new Kinetic.Image({x:a-10,y:285,image:i.bambu}),q=new Kinetic.Image({x:a+625-10,y:285,image:i.bambu}),r=new Kinetic.Image({x:1004,y:285,image:i.bambu}),t=new Kinetic.Image({x:540,y:500,rotation:-Math.PI/2,image:i.bambu}),x=new Kinetic.Image({x:a-10,y:760,rotation:-Math.PI/2,image:i.bambu}),z=new Kinetic.Image({x:540,y:760,rotation:-Math.PI/2,image:i.bambu}),A=new Kinetic.Image({x:a-10,y:20,rotation:-Math.PI/2,image:i.bambu}),
C=new Kinetic.Image({x:540,y:20,rotation:-Math.PI/2,image:i.bambu});D.add(h);D.add(l);u.add(c);u.add(f);j.add(k);w(u,a,a+625,e+600);y(u,500,e+600-150);y(u,400,e+600-160);y(u,200,e+600-140);j.add(m);j.add(n);j.add(o);D.add(t);j.add(p);j.add(q);j.add(r);j.add(x);j.add(z);j.add(A);j.add(C);D.draw();j.draw()};var U=function(){var a=0,b=G.getContext();b.font="18pt Arial";b.fillStyle="black";return{V:function(d){if(0==a||500<d.time-a)G.clear(),b.fillText("FPS: "+Math.round(1E3/d.timeDiff),10,25),a=d.time}}}(),
l;l=new Kinetic.Layer;r=new Kinetic.Text({text:"V\u00e4nta...",fontSize:36,fontFamily:"Arial",textFill:"white",x:g.width/2,y:g.height/2,align:"center"});l.add(r);l.p=r;this.T=function(a,b){g.add(l);s.log("VIEW: Preparing view...");A(a,b)};this.start=function(){g.remove(l);s.log("VIEW: Start rolling view...");g.onFrame(z);g.start()}};