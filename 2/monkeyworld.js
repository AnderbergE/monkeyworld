var g=void 0,o=!0,q=null,u=!1;function w(){return function(){}}function ba(b){return function(){return b}}
var x=new function(){var b={global:{language:{h:"en"},monkeySeeRounds:{h:1},triesBeforeGuardianAngel:{h:3}},miniGames:{fishingGame:{targetNumber:{h:2},numberCorrect:{h:1},numberOfFish:{h:7},maxNumber:{h:9}}}};this.aa=function(){return b};this.get=function(a){for(var c=b,d=0;d<arguments.length;d++)c=c[arguments[d]];return c.h};this.set=function(a){for(var c=b,d=0;d<arguments.length-1;d++)c=c[arguments[d]];c.h=arguments[arguments.length-1]};this.Bb=function(){var a=JSON.parse($.cookie("monkeyWorldSettings"));
a!==q&&(b=a)};this.yb=function(a,c){for(var d=a.split("-"),f=b,e=0;e<d.length;e++)f=f[d[e]];f.h=c}};
function ca(){function b(a,c){for(var d in a)if("object"===typeof a[d]&&a[d].h===g)b(a[d],c+"-"+d);else if(a[d].h!=g){var e=$("#"+c+"-"+d).val();x.yb(c+"-"+d,e)}}function a(){$("#settings-panel").append('<div id="settings-panel-content">');e=$("#settings-panel-content");e.append("<h1>"+y("SETTINGS_LABEL")+"</h1>");e.append("<form>");var a=f.aa(),b;for(b in a)e.append(d(b,2,"")),e.append(c(a[b],2,b));e.append("<button type=\"button\" onclick=\"window['egame']['hideSettings']()\">"+y("SETTINGS_CANCEL")+
"</button>");e.append("<button type=\"button\" onclick=\"window['egame']['applySettings']();window['egame']['hideSettings']()\">"+y("SETTINGS_APPLY")+"</button>");e.append("</form>");e.append("</div>")}function c(a,b,e){var f;f="<ul>";for(var l in a)if("object"===typeof a[l]&&a[l].h===g)f+=d(l,b+1,e),f+=c(a[l],b+1,e+"-"+l);else{f+="<li>";f+=d(l,b+1,e);var p="",p=p+('<input type="text" id="'+(e+"-"+l)+'" value="'+a[l].h+'" />');f+=p+"</li>"}return f+"</ul>"}function d(a,b,d){var c="",a="SETTINGS_"+
((d===g?"":d+"_")+a).toUpperCase().replace("-","_")+"_LABEL",a=y(a);a!=q&&(c+="<h"+b+">"+a+"</h"+b+">");return c}var f=x,e=$("#settings-panel-content");this.apply=function(){var d=f.aa(),c;for(c in d)"object"===typeof d[c]&&b(d[c],c);e.remove();a()};this.show=function(){a();$("#settings-panel").show()};this.hide=function(){e.remove();$("#settings-panel").hide()}};var da={INIT_LOADING_SOUNDS:{sv:"Laddar ner ljud...",en:"Downloading sounds..."},INIT_LOADING_IMAGES:{sv:"Laddar ner bilder...",en:"Downloading images..."},RESTART:{sv:"Starta om",en:"Restart"},SETTINGS:{sv:"Inst\u00e4llningar",en:"Settings"},YAY:{sv:"Hurra!",en:"Yay!"},ARE_YOU_READY_TO_TEACH:{sv:"\u00c4r du redo att l\u00e4ra apan?",en:"Are you ready to teach monkey?"},FISHING_CATCH_NUMBER:{sv:"F\u00e5nga nummer %1",en:"Catch number %1"},FISHING_CATCH:{sv:"F\u00e5nga",en:"Catch"},FISHING_FREE_WRONG_ONES:{sv:"Frige fiskarna som \u00e4r fel",
en:"Put back the wrong fish"},FISHING_NOT_THIS_ONE:{sv:"Inte den!",en:"Not this one!"},FISHING_THERE_ARE_MORE:{sv:"Det finns mer fiskar att f\u00e5nga. Forts\u00e4tt leta!",en:"There are more fish to catch. Keep looking!"},FISHING_ARE_YOU_SURE:{sv:"\u00c4r du s\u00e4ker?",en:"Are you sure?"},FISHING_COUNT_FISH:{sv:"R\u00e4kna fiskarna!",en:"Count the fish!"},FISHING_COUNT_TARGET_FISH:{sv:"R\u00e4kna fiskarna med",en:"Count the fish with"},FISHING_ANGEL_CHOOSE_FISH:{sv:"Jag v\u00e4ljer den h\u00e4r fisken eftersom...",
en:"I choose this fish, because it..."},FISHING_ANGEL_COUNT:{sv:"Jag v\u00e4ljer den h\u00e4r siffran eftersom...",en:"I choose this number, because..."},BUBBA_HI:{sv:"Hej! Mitt namn \u00e4r Bubba!",en:"Hi, my name is Bubba!"},BUBBA_HERE_TO_HELP:{sv:"Jag ska hj\u00e4lpa dig och apan l\u00e4ngs v\u00e4gen.",en:"I'm here to help you and monkey throughout his journey."},MONKEY_LEARNED_WELL:{sv:"Toppen! Apan l\u00e4rde sig bra!",en:"Great! Monkey learned well!"},MONKEY_DIDNT_LEARN_WELL:{sv:"\u00c5h, nej! Apan l\u00e4rde sig inte riktigt.",
en:"Oh no! Monkey didn't learn well."},LETS_SHOW_HIM_AGAIN:{sv:"Visa honom igen!",en:"Let's show him again!"},THANK_YOU_FOR_HELPING:{sv:"Tack f\u00f6r att du hj\u00e4lpte apan!",en:"Thank you for helping monkey!"},NOW_MONKEY_SHOW_YOU:{sv:"Nu visar apan dig vad den har l\u00e4rt sig!",en:"Now monkey show you what it learned!"},MONKEYS_TURN:{sv:"Apans tur!",en:"Monkey's turn!"},MONKEY_HMM:{sv:"Apan: Hmmm...",en:"Monkey: Hmm..."},FISHING_KEEP_GOING:{sv:"Forts\u00e4tt!",en:"Keep going!"},NUMBER_1:{sv:"nummer 1",
en:"number 1"},NUMBER_2:{sv:"nummer 2",en:"number 2"},NUMBER_3:{sv:"nummer 3",en:"number 3"},NUMBER_4:{sv:"nummer 4",en:"number 4"},NUMBER_5:{sv:"nummer 5",en:"number 5"},NUMBER_6:{sv:"nummer 6",en:"number 6"},NUMBER_7:{sv:"nummer 7",en:"number 7"},NUMBER_8:{sv:"nummer 8",en:"number 8"},NUMBER_9:{sv:"nummer 9",en:"number 9"},NUMBER_10:{sv:"nummer 10",en:"number 10"},SETTINGS_LABEL:{sv:"Inst\u00e4llningar",en:"Settings"},SETTINGS_APPLY:{sv:"Verkst\u00e4ll",en:"Apply"},SETTINGS_SHOW:{sv:"Visa inst\u00e4llningar",
en:"Show settings"},SETTINGS_HIDE:{sv:"G\u00f6m inst\u00e4llningar",en:"Hide settings"},SETTINGS_CANCEL:{sv:"Avbryt",en:"Cancel"},SETTINGS_GLOBAL_LABEL:{sv:"Globala",en:"Global"},SETTINGS_GLOBAL_LANGUAGE_LABEL:{sv:'Spr\u00e5k (kan vara "sv" eller "en" och kr\u00e4ver omstart)',en:'Language (can be "sv" or "en" and requires restart)'},SETTINGS_GLOBAL_MONKEYSEEROUNDS_LABEL:{sv:"Monkey See-rundor",en:"Monkey See rounds"},SETTINGS_GLOBAL_TRIESBEFOREGUARDIANANGEL_LABEL:{sv:"F\u00f6rs\u00f6k innan skydds\u00e4ngel",
en:"Tries before guardian angel"},SETTINGS_MINIGAMES_LABEL:{sv:"Minispel",en:"Mini-games"},SETTINGS_MINIGAMES_FISHINGGAME_LABEL:{sv:"Fiskespel",en:"Fishing Game"},SETTINGS_MINIGAMES_FISHINGGAME_TARGETNUMBER_LABEL:{sv:"M\u00e5lnummer",en:"Target number"},SETTINGS_MINIGAMES_FISHINGGAME_NUMBERCORRECT_LABEL:{sv:"Antal korrekta fiskar",en:"Number of correct fish"},SETTINGS_MINIGAMES_FISHINGGAME_NUMBEROFFISH_LABEL:{sv:"Antal fiskar totalt",en:"Number of fish totally"},SETTINGS_MINIGAMES_FISHINGGAME_MAXNUMBER_LABEL:{sv:"H\u00f6gsta m\u00f6jliga nummer",
en:"Maximum number on fish"}};function y(b,a){if(da[b]===g)return q;for(var c=da[b][x.get("global","language")],d=1;d<arguments.length;d++)c=c.replace("%"+d,arguments[d]);return c};function z(b,a,c){this.M=b;this.N=a;this.oa=c}
var fa=new z("19446__totya__yeah",y("YAY")),ga=new z(q,y("ARE_YOU_READY_TO_TEACH")),ha=new z("60443__jobro__tada1",q,2),ia=new z(q,y("FISHING_FREE_WRONG_ONES")),ja=new z(q,y("FISHING_CATCH")),ma=new z(q,y("FISHING_NOT_THIS_ONE")),na=new z(q,y("FISHING_THERE_ARE_MORE")),oa=new z(q,y("FISHING_KEEP_GOING")),pa=new z(q,y("FISHING_ARE_YOU_SURE")),xa=new z(q,y("FISHING_COUNT_FISH")),ya=new z(q,y("FISHING_COUNT_TARGET_FISH")),za=new z("34968__mike-campbell__f-s-1-fishing-reel",q),Aa=new z("water_movement_fast_002",
q),Ba=new z("60009__qubodup__swosh-22",q),Ca=new z(q,y("FISHING_ANGEL_CHOOSE_FISH")),Da=new z(q,y("FISHING_ANGEL_COUNT")),Ea=new z(q,y("BUBBA_HI")),Fa=new z(q,y("BUBBA_HERE_TO_HELP")),Ga=new z(q,y("MONKEY_LEARNED_WELL")),Ha=new z(q,y("MONKEY_DIDNT_LEARN_WELL")),Ia=new z(q,y("LETS_SHOW_HIM_AGAIN")),Ja=new z(q,y("THANK_YOU_FOR_HELPING")),Ka=new z(q,y("NOW_MONKEY_SHOW_YOU")),La=new z(q,y("MONKEY_HMM")),Ma=new z("51710__bristolstories__u-chimes3_short",q),Na=new z(q,y("NUMBER_1")),Oa=new z(q,y("NUMBER_2")),
Pa=new z(q,y("NUMBER_3")),Qa=new z(q,y("NUMBER_4")),Ra=new z(q,y("NUMBER_5")),Sa=new z(q,y("NUMBER_6")),Ta=new z(q,y("NUMBER_7")),Ua=new z(q,y("NUMBER_8")),Va=new z(q,y("NUMBER_9")),Wa=new z(q,y("NUMBER_10")),Xa={ec:fa,Hb:ga,Xb:ha,Qb:ia,Nb:ja,Sb:ma,Vb:na,Rb:oa,Mb:pa,Ob:xa,Pb:ya,Wb:za,Tb:Aa,Ub:Ba,Kb:Ca,Lb:Da,Jb:Ea,Ib:Fa,bc:Ga,$b:Ha,Yb:Ia,dc:Ja,cc:Ka,ac:La,Zb:Ma,NUMBER_1:Na,NUMBER_2:Oa,NUMBER_3:Pa,NUMBER_4:Qa,NUMBER_5:Ra,NUMBER_6:Sa,NUMBER_7:Ta,NUMBER_8:Ua,NUMBER_9:Va,NUMBER_10:Wa},Ya=q;
function Za(){Ya=[];for(var b in Xa){var a=Xa[b];Xa[b].T=b;if(a.M!=q){var c={id:b,src:"../res/sound/"+a.M+".ogg|../res/sound/"+a.M+".mp3"};a.oa!=g&&(c.data=a.oa);Ya.push(c)}}}Za();
var C=new function(){function b(a){for(var b=0;b<d.length;b++)d[b].attrs.y-=30;d.push(a)}var a=q,c=q,d=[];this.Cb=function(b){a=b;c=a.Ea};this.play=function(f){A.sb('"'+f.N+'"');f.M!=q&&SoundJS.play(f.T);var e=y(f.T);e!=q&&(f.N=e);if(f.N!=q){var i=new Kinetic.Text({x:c.getParent().attrs.width/2,y:c.getParent().attrs.height-50,text:f.N,fontSize:26,fontFamily:"Arial",textFill:"white",fill:"gray",textStroke:"black",align:"center",verticalAlign:"middle",textStrokeWidth:1});b(i);c.add(i);a.G();setTimeout(function(){c.remove(i);
a.G();for(var b=0;b<d.length;b++)d[b]===i&&d.splice(b,1)},3E3)}}};var $a={fish0:"fish/0.png",fish1:"fish/1.png",fish2:"fish/2.png",fish3:"fish/BlueFish_256x256.png",fish4:"fish/GreenFish_256x256.png",fish5:"fish/RedFish_256x256.png",fish6:"fish/YellowFish_256x256.png",fish7:"fish/Gold-Fish.png",fish8:"fish/Clown-Fish.png",bamboo:"bambu.png",plant:"plant.png",sky:"sky.png",basket:"01-tileable-basket-weave-textures-preview-003.jpg",monkey:"monkey.png",avatar:"Boo-icon.png",monkey_icon:"Gnome-Face-Monkey-64.png",green:"1333364667_Circle_Green.png",red:"1333364683_Circle_Red.png",
"person-yes":"Accept-Male-User.png","person-no":"Remove-Male-User.png","banana-big":"1333448754_Banana.png","banana-small":"1333448736_Banana64.png","happy-face":"Positive.png","sad-face":"Negative.png",rafiki:"Rafiki.png"},D={},db=0,eb=0,fb;for(fb in $a)db++;function gb(b){A.debug("Loading images...","images");var a=0,c=Object.size($a),d;for(d in $a)D[d]=new Image,D[d].onload=function(){++a>=c&&b();eb=a/db},D[d].src="../res/img/"+$a[d]};function hb(){var b=0,a=1,c=1,d=1,f=d,e=3,i=1,m=L,j=u,k=[],l=u;this.ya=function(){f=d=x.get("global","monkeySeeRounds");e=x.get("global","triesBeforeGuardianAngel")};this.ya();this.ob=function(){return f===c};this.ub=function(){i=1};this.sa=function(){k=[];c=a=1};this.Ka=function(){i++};this.Fb=function(){return i>=e};this.jb=function(){j=o};this.kb=function(){return j};this.$a=function(){return d};this.Za=function(){return f};this.tb=function(a){k.push(a)};this.fb=function(){return k};this.Ha=function(){A.debug("Adding banana",
"game");b++};this.Ja=function(){a++};this.ab=function(){return a};this.Ia=function(){c++};this.q=function(){return c};this.s=function(a){m=a};this.c=function(){return m};this.Xa=function(){return b};this.vb=function(){l=u};this.L=function(){l=o};this.ba=function(){return l}};function ib(){}ib.prototype.t=w();ib.prototype.U="Player";var N="Child Play",L="Monkey See",O="Monkey Do",P="Guardian Angel";function jb(){var b=[],a=u,c=new kb;this.z=function(a){b.push(a)};this.ca=function(){b=[]};this.L=function(){a=o};this.ba=function(){return a};this.ra=function(){a=u};this.ia=function(){return b};this.xb=function(){A.debug("Round done","game");c.b("Game.roundDone");c.b("Game.nextRound")};this.play=function(a,b,e){c=b;a.t[this.U](this,b,e)}}jb.prototype=new lb;jb.prototype.U="GameModule";jb.prototype.c=function(){return this.mode};
jb.prototype.s=function(b){this.mode=b};function mb(){A.debug("Creating MonkeyPlayer","player")}mb.prototype=new ib;mb.prototype.t=w();
mb.prototype.t.FishingGame=function(b,a,c){function d(){setTimeout(function(){C.play(La);setTimeout(function(){var a=c[e++];b.V(a);e<c.length&&d()},2E3)},1E3)}function f(){var a=c[e++];e<=c.length&&"FishingGame.catchingDone"!=a&&this.setTimeout(function(){"correct"==a?b.A(b.la(),function(){f()}):"incorrect"==a?b.A(b.cb(),function(){f()}):"freeIncorrect"==a?b.X(b.eb(),function(){f()}):"freeCorrect"==a?b.X(b.bb(),function(){f()}):A.error("Error when handling happenings (no such happening: "+a+")","monkey")},
2E3)}A.debug("Applying MonkeyPlayer's strategy to the FishingGame","player");var e=0;a.on("Game.start",function(){b.O();b.va()},"MonkeyPlayer");a.on("FishingGame.started",function(){f()},"MonkeyPlayer");a.on("FishingGame.countingStarted",function(){d()},"MonkeyPlayer");a.on("Game.tearDown",function(){a.n("MonkeyPlayer")},"MonkeyPlayer")};function nb(){A.debug("Creating AngelPlayer","player")}nb.prototype=new ib;nb.prototype.t=w();
nb.prototype.t.FishingGame=function(b,a){function c(){f<b.ka()&&(C.play(Ca),setTimeout(function(){f++;b.A(b.la(),function(){c()})},1E3))}function d(){setTimeout(function(){C.play(Da);setTimeout(function(){b.V(b.ka())},1E3)},2E3)}var f=0;A.debug("Applying AngelPlayer's strategy to the FishingGame","player");a.on("Game.start",function(){f=0;b.O();b.va()},"AngelPlayer");a.on("FishingGame.started",function(){setTimeout(function(){c()},2E3)},"AngelPlayer");a.on("FishingGame.countingStarted",function(){d()},
"AngelPlayer");a.on("Game.tearDown",function(){a.n("AngelPlayer")},"AngelPlayer")};function ob(){A.debug("Creating GamerPlayer","player")}ob.prototype=new ib;ob.prototype.t=w();ob.prototype.t.FishingGame=function(b,a){A.debug("Applying GamerPlayer's strategy to the FishingGame","player");a.on("fishinggame.started",function(){A.debug("Starting to think","player");a.b("fishinggame.allowClicks")},"GamerPlayer");a.on("Game.tearDown",function(){a.n("GamerPlayer")},"GamerPlayer")};function pb(b,a,c,d,f){var e=Math.floor(7*Math.random()),i=d,m=f,j=Math.random()*(1-0.7)+0.7,k=2*Math.random()*Math.PI,l=1,p=0.3072*j,h=0.2133*j,B=o;this.toString=function(){return"Fish "+a};var r=Math.random()*(8.0E-5-6.0E-5)+6.0E-5,s=Math.random()*(0.5-0.6)+0.6;this.ma=function(){return i};this.ib=function(){return m};this.g=function(){return c};this.getWidth=ba(0.3072);this.getHeight=ba(0.2133);this.F=function(){return p};this.gb=function(){return h};this.getScale=function(){return j};this.hb=
function(){return e};this.D=function(){return l};var n=u;this.Pa=function(){return B};this.zb=function(){B=u};this.Y=function(){switch(e){case 0:return{x:0.1,y:0};case 1:return{x:0.1,y:0};case 2:return{x:0.1,y:0};case 3:return{x:0.1,y:0};case 4:return{x:0.06,y:0.07};case 5:return{x:0.06,y:0.07};case 6:return{x:0.1,y:0};default:return{x:0,y:0}}};this.$=function(){n=o};var t=this;this.onFrame=function(a){n||(m=f+0.03*Math.cos(s*(k+2*a.time*Math.PI/3E3)),i=1==l?i+r*a.timeDiff:i-r*a.timeDiff,b.b("fishinggame.fishmoved",
{d:t}))};this.mb=function(a){l=-1;b.b("fishinggame.fishturnedleft",{d:this});i=a-(i-a);b.b("fishinggame.fishmoved",{d:this})};this.lb=function(a){l=1;b.b("fishinggame.fishturnedright",{d:this});i=a+(a-i);b.b("fishinggame.fishmoved",{d:this})};var v=u;this.isCaptured=function(){return v};this.capture=function(){v=o};this.Va=function(){n=v=u};b.b("fishinggame.initiatedfish",{d:this})};function Q(b,a){function c(a){a.$()}function d(){if(p==B||l==j.length){for(var a=0;a<j.length;a++)j[a].g()==h&&j[a].zb();l==B||m==L||m==O?(l!=B&&i.L(),i.z("FishingGame.catchingDone"),b.b("FishingGame.catchingDone"),b.b("FishingGame.countingStarted")):b.b("FishingGame.freeWrongOnes")}}function f(){var a=q;m==N?(a=na,b.b("FishingGame.inactivity",{ta:a}),e()):m==L&&(a=oa,b.b("FishingGame.inactivity",{ta:a}),e())}function e(){G&&!(p==B||l==j.length)&&(T=setTimeout(f,5E3))}var i=this,m=a.c();A.debug("Applying "+
m+" Mode","model");this.U="FishingGame";this.toString=ba("Fish Tank");for(var j=[],k=[],l=0,p=0,h=x.get("miniGames","fishingGame","targetNumber"),B=x.get("miniGames","fishingGame","numberCorrect"),r=x.get("miniGames","fishingGame","numberOfFish"),s=x.get("miniGames","fishingGame","maxNumber"),n={"0":{x:0.3,y:0.3},1:{x:0.8,y:0.4},2:{x:0.6,y:0.6},3:{x:1,y:0.65},4:{x:0.4,y:0.2},5:{x:0.1,y:0.5},6:{x:1,y:0.8},7:{x:0.8,y:0.2}},s=W.Ra(1,s,r,h,B,o),t=0,v=0;v<r;v++){var F=n[v%7];j.push(new pb(b,t++,s[v],F.x,
F.y))}this.onFrame=function(a){for(var b=0;b<j.length;b++){var c=j[b];c.onFrame(a);var d=c.ma();0<c.D()&&d>=1-c.F()/2?c.mb(1-c.F()/2):0>c.D()&&d<=c.F()/2&&c.lb(c.F()/2)}};this.wa=function(){for(var a=0;a<j.length;a++)b.b("fishinggame.turnOnClick",{d:j[a]})};this.ka=function(){return B};this.g=function(){return h};this.O=function(){A.debug("Turning off clicks","FishingGame");for(var a=0;a<j.length;a++)b.b("fishinggame.turnOffClick",{d:j[a]})};var G=o;this.va=function(){G=u};var T=q;this.ga=function(){T!=
q&&clearTimeout(T)};this.pa=function(){e()};this.Wa=function(){return j};this.Da=function(a){var b=this.ja();b==k.length?k.push(a):k[b]=a;l++;a.g()==h?(p++,this.z("correct")):this.z("incorrect");a.capture()};this.B=function(){this.ga()};this.A=function(a,e){b.b("FishingGame.catch",{d:a,$:c,W:function(){i.Da(a);d();e!=g&&e()}})};this.X=function(a,c){a.g()==B?this.z("freeCorrect"):this.z("freeIncorrect");b.b("FishingGame.free",{d:a,W:function(){for(var b=0;b<k.length;b++)k[b]===a&&(k[b]=g);l--;a.g()==
h&&p--;d();a.Va();c!=g&&c()}})};this.ja=function(){for(var a=1E3,b=u,c=0;c<k.length;c++)k[c]===g&&c<a&&(a=c,b=o);return b?a:k.length};this.Ya=function(){return k};var J=0;this.V=function(c){if(a.c()===L&&0==J||a.c()!=L){J++;this.z(c);var d=c==B||a.c()!=N;c==B||this.L();b.b("FishingGame.counted",{qa:c});b.b("FishingGame.countingResult",{Qa:d})}};this.start=function(){e()};this.la=function(){for(var a=0;a<j.length;a++){var b=j[a];if(!b.isCaptured()&&b.g()==h)return b}return q};this.cb=function(){for(var a=
0;a<j.length;a++){var b=j[a];if(!b.isCaptured()&&b.g()!=h)return b}return q};this.eb=function(){for(var a=0;a<j.length;a++)if(j[a].isCaptured()&&j[a].g()!=h)return j[a];return q};this.bb=function(){for(var a=0;a<j.length;a++)if(j[a].isCaptured()&&j[a].g()==h)return j[a];return q};this.Ga=function(){this.xb()}}Q.prototype=new jb;function qb(){var b={};this.on=function(a,c,d){a in b||(b[a]=[]);b[a].push(c);c.Q=d;A.debug((d===g?"unnamed":d)+" registerd "+a,"evm")};this.off=function(a,c){for(var d=0;d<b[a].length;d++)b[a][d].Q===c&&b[a].splice(d,1);0==b[a].length&&delete b[a]};this.print=function(){console.log("-------EVENT MANAGER STATE-----------------");for(var a in b){console.log("key: "+a);for(var c=0;c<b[a].length;c++)console.log("   "+b[a][c].Q)}console.log("-------------------------------------------")};this.n=function(a){var c=
0,d;for(d in b){for(var f=0;f<b[d].length;f++)b[d][f].Q===a&&(b[d].splice(f,1),c++);0==b[d].length&&delete b[d]}A.debug("Forgot "+c+" event registred by "+a,"evm")};this.b=function(a,c){var d=b[a];if(d!=g)for(var f=0;f<d.length;f++)(0,d[f])(c)};this.stop=function(a){SoundJS.stop(a.T)}}function kb(){this.on=w();this.b=w()};SoundJS.sc=w();var rb=q;window.egame=q;window.onload=function(){rb=new vb;window.egame=rb};
function vb(){var b=new hb;function a(){k!=q&&m.remove(k);l!=q&&m.remove(l);m.add(k=new Kinetic.da({x:e.getWidth()-100*e.a,y:3,width:100*e.a,text:y("SETTINGS"),callback:function(){p.showSettings()}}));m.add(l=new Kinetic.da({x:e.getWidth()-203*e.a,y:3,width:100*e.a,text:y("RESTART"),callback:function(){p.wb()}}))}function c(a,c,f){d();var n=q;b.c()===N||b.c()===L?n=B:b.c()===O?n=r:b.c()===P&&(n=s);A.debug("Creating model...","game");c=new c(h,b,f);A.debug("Initiating model...","game");n!=q&&(A.debug("Requesting player to play...",
"game"),b.c()===O?c.play(n,h,b.fb()[b.q()-1]):c.play(n,h));new a(h,e,b,c);h.b("Game.initiate");c.start();t=c;h.b("Game.start");m.moveToTop();i.moveToTop()}function d(){t.B();t.ra();t.ca();t=n;h.b("Game.tearDown");h.b("Game.viewTearDown")}var f=new ca;x.Bb();this.applySettings=function(){f.apply();$.cookie("monkeyWorldSettings",JSON.stringify(x.aa()))};this.hideSettings=function(){f.hide()};this.showSettings=function(){f.show()};var e=new Kinetic.Stage({container:"container",width:1024,height:768});
document.body.style.backgroundImage="background-image: linear-gradient(bottom, rgb(0,77,0) 24%, rgb(92,250,174) 74%, rgb(0,204,255) 87%)";(function(){var a=window.innerWidth-10,b=window.innerHeight-10,c=a,d=3*(c/4);d>b&&(d=b,c=4*(d/3));e.attrs.width=c;e.attrs.height=d;if(c<a){var f=document.getElementById("container");f.style.left=Math.round((a-c)/2)+"px"}d<b&&(f=document.getElementById("container"),f.style.top=Math.round((b-d)/2)+"px")})();e.a=e.getWidth()/1024;var i=new Kinetic.Layer,m=new Kinetic.Layer,
j=new Kinetic.Layer;e.add(j);e.add(m);e.add(i);e.Ea=m;e.Ca=m;e.fc=j;e.R=u;e.ic=0;e.gc=0;e.G=function(){e.R=o};e.ea=u;e.oc=function(){e.ea=o};e.fa=o;e.pc=function(){e.ea=o;e.fa=u};e.qc=function(){e.fa=o};Kinetic.da=function(a){a.width===g&&(a.width=100*e.a);a.height===g&&(a.height=20*e.a);var b=new Kinetic.Group({x:a.x,y:a.y,width:a.width,height:a.height}),c=new Kinetic.Rect({x:0,y:0,width:a.width,height:a.height,fill:"#ccc",strokeWidth:1,stroke:"white"}),d=new Kinetic.Text({text:a.text,fontFamily:"Arial",
textFill:"black",fontSize:10*e.a,x:a.width/2,y:a.height/2,verticalAlign:"middle",align:"center"});b.add(c);b.add(d);b.on("mousedown touchstart",a.callback);return b};var k=q,l=q,p=this;a();C.Cb(e);var h=new qb,B=new ob,r=new mb,s=new nb;(new wb(h,e,b)).K();var n=new yb,t=n,v=function(){var a=0,b=new Kinetic.Text({text:"",fontFamily:"Arial",textFill:"black",textStroke:"white",textStrokeWidth:1,fontSize:18,x:0,y:0});m.add(b);return{Eb:function(c){if(0==a||10<c.time-a)b.setText("FPS: "+Math.round(1E3/
c.timeDiff)),a=c.time}}}(),F=function(){var a=q;return{hide:function(){a.setText("");e.G()},show:function(b){a!=q?(a.moveTo(m),e.G(),a.setText(b),a.setPosition(e.attrs.width/2,150*e.a)):(a=new Kinetic.Text({x:e.attrs.width/2,y:150,text:b,fontSize:26,fontFamily:"Short Stack",textFill:"white",textStroke:"black",align:"center",verticalAlign:"middle",scale:{x:0.001,y:0.001},textStrokeWidth:1}),W.f(a,e.a));m.add(a);Tween.get(a.attrs.scale).to(W.f({x:2,y:2},e.a),1E3).wait(3E3).call(function(){Tween.get(a.attrs.scale).to(W.f({x:1,
y:1},e.a),1E3).call(w());Tween.get(a.attrs).to({y:50*e.a},1E3).call(function(){a.moveTo(i);e.G()})})}}}();h.on("Game.showBig",function(a){F.show(a.text)},"game");h.on("Game.hideBig",function(){F.hide()},"game");e.onFrame(function(a){v.Eb(a);h.b("frame",{frame:a});t.onFrame(a);m.draw();e.R&&(i.draw(),e.R=u);Tween.tick(a.timeDiff,u)});e.start();var G={kc:9,nc:7,rc:3,mc:1};h.b("Game.loadingSounds");var T=q,J=q;A.debug("Loading sounds...","Game");var M=new PreloadJS(u);M.onComplete=function(){clearInterval(T);
J=setInterval(function(){h.b("Game.updateImageLoading",{progress:eb})},50);A.debug("Sounds loaded.","game");h.b("Game.loadingImages");gb(function(){h.b("Game.loadingDone");clearInterval(J);c(X,Q,G)})};M.installPlugin(SoundJS);T=setInterval(function(){h.b("Game.updateSoundLoading",{progress:M.progress})},50);M.loadManifest(Ya);h.on("Game.setMode",function(a){b.s(a.mode)},"game");h.on("Game.nextRound",function(){if(b.c()==N){var a=function(){c(X,Q,G)};h.b("Game.readyToTeach",{Gb:function(){b.s(L);h.b("Game.getBanana",
{callback:a})},rb:function(){a()}})}else b.c()==L?(b.tb(t.ia()),t.ba()&&b.L(),t.ca(),b.ab()<b.$a()?(b.Ja(),c(X,Q,G)):(d(),b.s(O),C.play(Ja),h.b("Game.thankYouForHelpingMonkey",{callback:function(){b.kb()?c(X,Q,G):(b.jb(),h.b("Game.getBanana",{callback:function(){c(X,Q,G)}}))}}))):b.c()==O?b.q()<b.Za()?(b.Ia(),c(X,Q,G)):(d(),b.ba()?h.b("Game.showSadSystemConfirmation",{callback:function(){b.Fb()?(b.vb(),b.s(P),h.b("Game.introduceBubba",{callback:function(){c(X,Q,G)}})):(b.Ka(),b.s(L),b.sa(),c(X,Q,
G))}}):h.b("Game.showHappySystemConfirmation",{callback:function(){h.b("Game.getBanana",{callback:function(){setTimeout(function(){h.b("Game.getBanana",{callback:function(){setTimeout(function(){h.b("Game.eatBananas")},1500)}})},200)}})}})):b.c()==P&&(b.sa(),b.ub(),b.s(L),c(X,Q,G))},"game");h.on("Game.startGame",function(a){c(a.view,a.lc,G)},"game");this.wb=function(){b=new hb;c(X,Q,G);Za();a();b.ya()}};function yb(){this.K=w();this.start=w();this.B=w();this.onFrame=w();this.ia=w();this.ca=w();this.ra=w()};Object.size=function(b){var a=0,c;for(c in b)b.hasOwnProperty(c)&&a++;return a};
var A=new function(){function b(a,b,d){d===g&&(d="");if("evm"!=d&&"sound"!=d){for(var d=d.substr(0,8),d=d.toUpperCase(),f=8-d.length,e=0;e<f;e++)d=" "+d;console.log(a+" "+d+" "+b)}}this.debug=function(a,c){b("DEBUG  ",a,c)};this.sb=function(a){b("NOTIFY ",a,"sound")};this.error=function(a,c){b("ERROR  ",a,c)}},W=new function(){function b(a,b,d,f){var e=0,i=0;this.next=function(){var m=a+e*d,j=b+i*f;e=(e+1)%2;0==e&&i++;return{x:m,y:j}}}this.nb=function(a){return!isNaN(a-0)};this.Ma=function(a,b,d,
f){function e(){var a,b;a===g&&(a=0);b===g&&(b=0);return{x:a,y:b}}return function(a,b,c,d,f){var p=new e;p.x=b.x*a*a*a+c.x*3*a*a*(1-a)+d.x*3*a*(1-a)*(1-a)+f.x*(1-a)*(1-a)*(1-a);p.y=b.y*a*a*a+c.y*3*a*a*(1-a)+d.y*3*a*(1-a)*(1-a)+f.y*(1-a)*(1-a)*(1-a);return p}(0.5,a,b,d,f)};this.f=function(a,b){a.x!=g&&(a.x*=b);a.y!=g&&(a.y*=b);a.width!=g&&(a.width*=b);a.height!=g&&(a.height*=b);a.fontSize!=g&&(a.fontSize*=b);if(a.scale!=g&&(a.scale.x!=g&&(a.scale.x*=b),a.scale.y!=g))a.scale.y*=b;return a};this.o=function(a,
b){return Math.floor(Math.random()*(b-a+1))+a};this.na=function(a,b){for(var d=0;d<a.length;d++)if(a[d]===b)return o;return u};this.Z=function(a,c,d,f){return new b(a,c,d,f)};this.Ra=function(a,b,d,f,e,i){5==arguments.length&&(i=u);for(var m=Array(d),j=Array(e),k=0;k<e;k++){for(var l=this.o(0,d-1);this.na(j,l);)l=this.o(0,d-1);j.push(l)}for(k=0;k<d;k++)if(this.na(j,k))m[k]=f;else if(m[k]=this.o(a,b),i)for(;m[k]==f;)m[k]=this.o(a,b);return m}};
function zb(){this.p=[];this.Fa=function(b,a){var c=a.k.e,d=o,f;for(f in c)0<c[f].H?(c[f].H-=b,a[f]+=c[f].step*b,d=u):a[f]=c[f].to;return d}}
function Y(b,a,c,d){a.k={};var f=a.k;f.e={};for(var e in c){f.e[e]={};f.e[e].to=c[e];if(d.duration!=g){var i=d.duration;W.nb(d.duration)||(d.duration[e]===g&&alert("Not defined duration for "+e),i=d.duration[e]);f.e[e].duration=i;f.e[e].xa=o}else f.e[e].duration=Math.abs(c[e]-a[e])/d.speed[e],f.e[e].speed=d.speed[e],f.e[e].xa=u;f.e[e].step=(c[e]-a[e])/f.e[e].duration;f.e[e].H=f.e[e].duration}f.Ta=d.onFrame!=g;f.Ua=d.r!=g;f.Na=d.onFrame;f.Oa=d.r;f.jc=Number.MAX_VALUE;f.ha=u;b.p.push(a)}
zb.prototype.tick=function(b){for(var a=0;a<this.p.length;a++)if(this.p[a].k.Ta&&this.p[a].k.Na(),this.Fa(b,this.p[a])){var c=this.p[a];this.p.splice(a,1);c.k.ha||(c.k.ha=o,c.k.Ua&&c.k.Oa())}};function wb(b,a,c){function d(a,b){p&&Tween.get(a.attrs).to({y:a.attrs.y-100*b},600).call(function(){d(a,-1*b)})}function f(a,b){m.splice(m.length-1);Tween.get(b.attrs).to({y:300,x:400},1E3).to({alpha:0},500).call(function(){k.attrs.text=++l;Tween.get(k.attrs).to({alpha:1},500).wait(1500).to({alpha:0},500);Tween.get(a.attrs.scale).to({x:1.2*a.attrs.scale.x,y:1.2*a.attrs.scale.y},1E3).wait(500).call(function(){0<m.length&&f(a,m[m.length-1])})})}function e(b,d){A.debug("Game.showSystemConfirmation",
"GGV");b?C.play(Ga):(C.play(Ha),c.ob()||setTimeout(function(){C.play(Ia)},1E3));var e=b?D["happy-face"]:D["sad-face"],f=new Kinetic.Image({image:e,x:a.getWidth()/2,y:a.getHeight()/2,centerOffset:{x:e.width/2,y:e.height/2},scale:{x:a.a,y:a.a}});W.f(f,a.a);i.add(f);setTimeout(function(){i.remove(f);d()},4E3)}var i=a.Ca,m=[];this.K=function(){A.debug("GeneralGameView kicking in","GGV")};this.B=function(){b.n("GeneralGameView")};b.on("Game.introduceBubba",function(b){var c=new Kinetic.Image({image:D.rafiki,
x:a.getWidth()/2,y:a.getHeight()/2,centerOffset:{x:D.rafiki.width/2,y:D.rafiki.height/2}});W.f(c,a.a);i.add(c);C.play(Ea);setTimeout(function(){C.play(Fa);setTimeout(function(){i.remove(c);b.callback()},2E3)},1E3)},"GeneralGameView");b.on("Game.showHappySystemConfirmation",function(a){e(o,a.callback)},"GeneralGameView");b.on("Game.showSadSystemConfirmation",function(a){e(u,a.callback)},"GeneralGameView");b.on("Game.thankYouForHelpingMonkey",function(b){var c=new Kinetic.Text({fontFamily:"Arial",fontSize:36*
a.a,textFill:"white",ua:"black",text:y("THANK_YOU_FOR_HELPING"),align:"center",y:a.getHeight()/2,x:a.getWidth()/2});i.add(c);setTimeout(function(){Tween.get(c.attrs).to({x:-300,y:-400,alpha:1},500).call(function(){i.remove(c);b.callback()})},1500)},"GeneralGameView");var j=new Kinetic.Text({fontFamily:"Arial",fontSize:36,textFill:"white",ua:"black",text:y("INIT_LOADING_SOUNDS"),align:"center",y:a.getHeight()/2+20,x:a.getWidth()/2});b.on("Game.loadingSounds",function(){i.add(j)},"GeneralGameView");
b.on("Game.loadingImages",function(){j.setText(y("INIT_LOADING_IMAGES"))},"GeneralGameView");b.on("Game.loadingDone",function(){i.remove(j)},"GeneralGameView");b.on("Game.updateSoundLoading",function(a){j.setText(y("INIT_LOADING_SOUNDS")+" "+Math.round(100*a.progress)+" %")},"GeneralGameView");b.on("Game.updateImageLoading",function(a){j.setText(y("INIT_LOADING_IMAGES")+" "+Math.round(100*a.progress)+" %")},"GeneralGameView");var k=q,l=0;b.on("Game.eatBananas",function(){b.on("Game.viewTearDown",
function(){p=u;b.n("GGV_EATBANANAS");i.remove(c);i.remove(k)},"GGV_EATBANANAS");k=new Kinetic.Text({fontFamily:"Arial",fontSize:72*a.a,textFill:"white",ua:"black",text:l,align:"center",y:a.getHeight()/2,x:a.getWidth()/2-a.getWidth()/4,alpha:0});var c=new Kinetic.Image({image:D.monkey,x:a.getWidth()/2,y:a.getHeight()/2,centerOffset:{x:D.monkey.width/2,y:D.monkey.height/2},scale:{x:a.a,y:a.a}});W.f(c,a.a);W.f(k,a.a);i.add(c);i.add(k);d(c,1);0<m.length&&f(c,m[m.length-1])},"GeneralGameView");var p=o;
b.on("Game.getBanana",function(b){c.Ha();var d=new Kinetic.Image({image:D["banana-big"],scale:{x:0.001,y:0.001},centerOffset:{x:256,y:256},x:a.attrs.width/2,y:a.attrs.height/2});W.f(d,a.a);m.push(d);i.add(d);C.play(ha);Tween.get(d.attrs).to({rotation:2*Math.PI},1E3).wait(1500).to({rotation:-Math.PI/2,x:a.attrs.width-50*a.a-48*(c.Xa()-1)*a.a,y:50*a.a},1E3);Tween.get(d.attrs.scale).to({x:2*a.a,y:2*a.a},1E3).wait(1500).to({x:0.125*a.a,y:0.125*a.a},1E3).call(function(){d.attrs.image=D["banana-small"]}).wait(1500).call(function(){b.callback()})},
"GeneralGameView");b.on("Game.readyToTeach",function(b){function c(){Tween.get(f.attrs).to({x:-300,y:-300},600).call(d);Tween.get(e.attrs).to({x:a.getWidth()+300,y:a.getHeight()+300},600).call(d);Tween.get(M.attrs).to({x:0,y:a.getHeight()+300},600).call(d)}function d(){J++;3===J&&(i.remove(f),i.remove(e),i.remove(M))}var e=new Kinetic.Group({x:a.getWidth()/2-200-128,y:300}),f=new Kinetic.Group({x:a.getWidth()/2+200-128,y:300}),j=new Kinetic.Image({image:D.green}),k=new Kinetic.Image({image:D.red}),
l=new Kinetic.Image({image:D.monkey_icon,scale:{x:2,y:2},x:100,y:100}),m=new Kinetic.Image({image:D["person-yes"],x:20,y:25}),p=new Kinetic.Image({image:D["person-no"],x:60,y:55});W.f(j,a.a);W.f(k,a.a);W.f(l,a.a);W.f(m,a.a);W.f(p,a.a);e.add(k);e.add(p);f.add(j);f.add(l);f.add(m);var J=0;f.on("mousedown touchstart",function(){f.off("mousedown touchstart");e.off("mousedown touchstart");c();b.Gb()});e.on("mousedown touchstart",function(){f.off("mousedown touchstart");e.off("mousedown touchstart");c();
b.rb()});i.add(f);i.add(e);var M=new Kinetic.Text({fontSize:48,fontFamily:"Arial",text:y("ARE_YOU_READY_TO_TEACH"),textFill:"white",align:"center",y:100,x:a.getWidth()/2});i.add(W.f(M,a.a));i.draw()},"GeneralGameView")};function X(b,a,c,d){function f(){b.b("Game.showBig",{text:y("FISHING_CATCH_NUMBER",H.g()).toUpperCase()});C.play(ja);setTimeout(function(){A.debug("Ready to play","view");C.play(Xa["NUMBER_"+H.g()]);b.b("FishingGame.started",q)},700)}function e(){b.n("FishingView_ROD");b.n("FishingView")}function i(){ka.Ab(b);H=d;ra=new M(30*a.a,"#3333ff","#aaaaff",4,-2*a.a);sa=new M(20*a.a,"blue","white",6,-2*a.a);ta=new M(15*a.a,"#598FD9","#8ED6FF",8,-1*a.a);for(var e=H.Wa(),U=0;U<e.length;U++)ub(e[U]);ka.Db(R);
ka.La(c);A.debug("Building stage...","view");e=new Kinetic.Shape({drawFunc:function(){var b=this.getContext();b.beginPath();b.moveTo(n,v+17*a.a);b.lineTo(n+s,v+17*a.a);b.lineTo(n+s,v+t);b.lineTo(n,v+t);var c=b.createRadialGradient(n+s/2,v,F,n+s/2,v,G);c.addColorStop(1,"#598FD9");c.addColorStop(0,"#8ED6FF");b.fillStyle=c;b.fill();b.closePath();this.fillStroke()}});D.sky.style.width=300*a.a+"px";Z=new Kinetic.Image({x:p,y:h,width:B,height:r,image:D.basket});U=new Kinetic.Image({x:n,y:50*a.a,width:s,
image:D.sky});K.add(U);R.add(Z);K.add(e);xb(K,n,n+s,v+t);qa(K,n+20,v+t-150);qa(K,n+100,v+t-160);qa(K,n+s-130,v+t-140);if(c.c()==O&&1<c.q()||c.c()==P)Z.attrs.x+=ea,K.attrs.x+=ea,E.attrs.x+=ea;ab=new tb(n,v-50*a.a/2,n+s/2,v-50*a.a,0.390625*a.getHeight());ua=new sb;ua.start();ta.start();ra.start();sa.start();R.add(K);R.draw();b.on("frame",function(a){V.tick(a.frame.timeDiff);E.draw()},"FishingView")}function m(a,b){if(a.Pa()){A.debug("Starting to free "+a,"fish");S&&H.O();var c=I[a];Y(V,c.attrs,{x:n+
s/2,y:v,rotation:Math.PI/2},{duration:{x:1E3,y:1E3,rotation:1E3},r:function(){C.play(Aa);c.attrs.centerOffset.x=0;c.attrs.centerOffset.y=0;var d=J(a);Y(V,c.attrs,{x:d.x,y:d.y,rotation:0},{duration:{x:1E3,y:1E3,rotation:1E3},onFrame:w(),r:function(){b();S&&H.wa()}})}})}else C.play(ma)}function j(){A.debug("Tearing down FishingView's layers","view");b.b("Game.hideBig");a.remove(R);a.remove(E);a.remove(bb)}function k(a){H.ga();S&&(a.isCaptured()?(H.X(a,w()),H.pa()):(A.debug("Starting to catch "+a,"fish"),
H.A(a,w())))}function l(a){I[a].on("mousedown touchstart",function(){S&&k(a)})}var p,h,B,r,s,n,t,v,F,G;function T(){K.moveTo(E);Z.moveTo(E);var b=s+n+300*a.a;E.attrs.centerOffset={x:b,y:0};E.attrs.x=b;Z.moveToBottom();K.moveToBottom();R.draw();Tween.get(E.attrs.scale).to({x:0},2E3).call(function(){E.attrs.centerOffset.x=0;E.attrs.x=ea;E.attrs.scale.x=0.1;Tween.get(E.attrs.scale).to({x:1},2E3).call(function(){K.moveTo(R);K.attrs.x=ea;R.draw()})})}function J(a){var b={};b.x=a.ma()*s+n;b.y=a.ib()*t+
v;return b}function M(b,c,d,e,f){function i(a,e){var n=m-a,j=new Kinetic.Ba({u:a,C:h+f,height:b,Sa:c,pb:d});k.add(j);Tween.get(j.attrs).to({u:s},1E3*(n/e)).call(function(){k.remove(j)})}function j(){for(var a=l;a<m;a+=2*(e*t/1E3))i(a,e)}var k=new Kinetic.Group({x:n,y:v});E.add(k);var l=60*-a.a,h=20*a.a,t=4E3*a.a,m=s;this.start=function(){j();this.S=setInterval(function(){i(l,e)},t)};this.stop=function(){clearInterval(this.S)}}function sb(){function b(){var c=W.o(350*a.a,360*a.a),d=W.o(2E4,5E4),e=
new Kinetic.za({x:W.o(150*a.a,330*a.a),y:c,radius:W.o(3*a.a,6*a.a)});Tween.get(e.attrs).to({y:360*a.a-c+80*a.a},d).call(function(){E.remove(e)});E.add(e)}this.start=function(){this.S=setInterval(b,3E3)};this.stop=function(){clearInterval(this.S)}}function tb(c,d,e,f,n){function i(a,b){var c=cb[H.ja()];c.rotation=2*a.D()*Math.PI;Tween.get(I[a].attrs).to(c,1500).call(function(){H.pa()});Tween.get(I[a].attrs.centerOffset).to({x:0,y:0},1500);Y(V,r.attrs,{length:n,i:0,j:f},{duration:{length:1E3,i:1E3,
j:200},onFrame:w(),r:function(){b();k();S&&H.wa()}})}function j(c,d){var e=I[c],f=c.Y();f.x*=s;f.y*=t;var U=c.D();e.attrs.centerOffset.y=f.y;e.attrs.x=0<U?e.attrs.x+f.x:e.attrs.x-f.x;e.attrs.centerOffset.x=f.x;C.play(za);Y(V,e.attrs,{rotation:-1*U*Math.PI/2},{duration:{rotation:500},onFrame:w(),r:w()});Y(V,r.attrs,{j:v-90*a.a,length:20*a.a},{speed:{j:0.4*a.a,length:0.5*a.a},onFrame:function(){var a=I[c];a.attrs.x=r.attrs.v;a.attrs.y=r.attrs.w;a=a.attrs.y<v;!m&&a&&(C.play(Aa),m=o)},r:function(){b.stop(za);
i(c,d)}})}function k(){b.on("frame",function(a){r.attrs.i+=1.0E-4*p*a.frame.timeDiff;r.attrs.i>=B?(p*=-1,r.attrs.i=B):r.attrs.i<=-B&&(p*=-1,r.attrs.i=-B)},"FishingView_ROD")}function l(a){a=h(a);return Math.atan((r.attrs.m-a.x)/(r.attrs.j-a.y))}function h(a){var b=a.D(),c=J(a),d={};d.x=c.x+b*a.Y().x*s;d.y=c.y+b*a.Y().y*t;return d}var m=u,p=1,B=Math.PI/30,r=new Kinetic.Aa({strokeWidth:2*a.a,I:c,m:e,P:d,j:f,length:n,i:0});E.add(r);setTimeout(w(),1E3);k();this.A=function(a,c,d){b.off("frame","FishingView_ROD");
S&&H.O();m=u;C.play(Ba);var e=l(a),f=h(a);Y(V,r.attrs,{i:e,length:Math.sqrt(Math.pow(r.attrs.m-f.x,2)+Math.pow(r.attrs.j-f.y,2))},{duration:{length:500,i:500},onFrame:function(){e=l(a);var b=h(a),c=r.attrs,b={i:e,length:Math.sqrt(Math.pow(r.attrs.m-b.x,2)+Math.pow(r.attrs.j-b.y,2))},d=c.k,f;for(f in b)d.e[f].to=b[f],d.e[f].xa?d.e[f].step=(b[f]-c[f])/d.e[f].H:(d.e[f].duration=Math.abs(b[f]-c[f])/d.e[f].speed,d.e[f].step=(b[f]-c[f])/d.e[f].duration,d.e[f].H=d.e[f].duration)},r:function(){d(a);j(a,c)}})}}
function ub(b){var c=J(b),c=new Kinetic.Group({x:c.x,y:c.y,width:b.getScale()*b.getWidth()*s,height:b.getScale()*b.getHeight()*t,centerOffset:{x:0,y:0}});E.add(c);var d=new Kinetic.Image({x:0,y:0,image:D["fish"+b.hb()],width:b.getScale()*b.getWidth()*s,height:b.getScale()*b.getHeight()*t,centerOffset:{x:b.F()*s/2,y:b.gb()*t/2}});d.setScale(-1,1);c.add(d);d=new Kinetic.Text({x:0,y:0,text:b.g(),fontSize:0.046875*a.getWidth(),fontFamily:"Gloria Hallelujah",textFill:"white",align:"center",verticalAlign:"middle",
textStroke:"#444",textStrokeWidth:2/1024*a.getWidth()});c.add(d);d.setScale(b.getScale());I[b]=c;va[b]=d;l(b)}function qa(a,b,c){b=new Kinetic.Image({x:b+64,y:c+64,image:D.plant,width:128,height:128,centerOffset:{x:64,y:64}});a.add(b)}function xb(a,b,c,d){var e=new Kinetic.Shape({drawFunc:function(){var a=this.getContext();a.beginPath();a.moveTo(b,d);a.lineTo(c,d);a.lineTo(c,d-50);a.quadraticCurveTo(b,d-50,b,d-80);a.closePath();this.fillStroke()},fill:"#EED6AF"});a.add(e)}var I={},va={},H=q,V=new zb,
ab=q,S=o,ua=q,ta=q,ra=q,sa=q;n=0.2783203125*a.getWidth();v=0.1953125*a.getHeight();s=0.390625*a.getWidth();t=580/768*a.getHeight();F=30*a.a;G=400*a.a;p=0.693359375*a.getWidth();h=50/768*a.getHeight();B=0.263671875*a.getWidth();r=400/768*a.getHeight();for(var ea=-240*a.a,cb={},la=W.Z(p+0.0625*a.getWidth(),h+r-64/768*a.getHeight(),0.1220703125*a.getWidth(),-128/768*a.getHeight()),aa=0;8>aa;aa++)cb[aa]=la.next();var wa=new Ab(b,a,c),E=new Kinetic.Layer,R=new Kinetic.Layer,K=new Kinetic.Group({x:0,y:0}),
Z=q,bb=R;a.add(R);a.add(bb);a.add(E);b.on("Game.viewTearDown",function(){j();wa.B();e()},"FishingView");b.on("FishingGame.catch",function(a){ab.A(a.d,a.W,a.$)},"FishingView");b.on("FishingGame.free",function(a){m(a.d,a.W)},"FishingView");b.on("fishinggame.turnOnClick",function(a){l(a.d)},"FishingView");b.on("fishinggame.turnOffClick",function(a){I[a.d].off("mousedown touchstart")},"FishingView");b.on("fishinggame.allowClicks",function(){S=o},"FishingView");b.on("fishinggame.disallowClicks",function(){S=
u},"FishingView");b.on("FishingGame.freeWrongOnes",function(){b.b("Game.showBig",{text:y("FISHING_FREE_WRONG_ONES").toUpperCase()});C.play(ia)},"FishingView");b.on("FishingGame.catchingDone",function(){S=u;b.b("Game.showBig",{text:y("YAY").toUpperCase()});C.play(fa);setTimeout(function(){b.off("frame","FishingView");ua.stop();ta.stop();ra.stop();sa.stop();j();wa.K(H,I)},2E3)},"FishingView");Kinetic.Ba=function(b){var c=new Kinetic.Shape(b),d=b.height,e=50*a.a;c.drawFunc=function(){var b=this.getContext();
b.beginPath();b.moveTo(0,-20*a.a);b.lineTo(s,-20*a.a);b.lineTo(s,20*a.a);b.lineTo(0,20*a.a);b.clip();b.beginPath();b.moveTo(c.attrs.u,c.attrs.C);b.lineTo(c.attrs.u+e,c.attrs.C);b.quadraticCurveTo(Math.floor(c.attrs.u+0.5*e),Math.floor(c.attrs.C-0.5*d),Math.floor(c.attrs.u+0.75*e),Math.floor(c.attrs.C-d));b.quadraticCurveTo(Math.floor(c.attrs.u+0.5*e),Math.floor(c.attrs.C-0.5*d),Math.floor(c.attrs.u),Math.floor(c.attrs.C));var f=b.createRadialGradient(s/2,0,F,s/2,0,G);f.addColorStop(1,c.attrs.Sa);
f.addColorStop(0,c.attrs.pb);b.fillStyle=f;b.fill();b.closePath();this.fillStroke()};c.stroke="black";c.strokeWidth=4;return c};Kinetic.za=function(a){a.l={};a.l.x=a.radius/2;a.l.y=-a.radius/2;a.l.radius=a.radius/3;var b=new Kinetic.Shape(a);b.drawFunc=function(){var a=this.getContext(),c=a.createRadialGradient(b.attrs.x,b.attrs.y,b.attrs.radius/2,b.attrs.x,b.attrs.y,b.attrs.radius),d=a.createRadialGradient(b.attrs.x+b.attrs.l.x,b.attrs.y+b.attrs.l.y,b.attrs.l.radius/5,b.attrs.x+b.attrs.l.x,b.attrs.y+
b.attrs.l.y,b.attrs.l.radius);a.beginPath();a.arc(Math.floor(b.attrs.x),Math.floor(b.attrs.y),b.attrs.radius,0,2*Math.PI,u);c.addColorStop(0,"rgba(255,255,255,0)");c.addColorStop(1,"rgba(255,255,255,1)");a.fillStyle=c;a.fill();a.beginPath();a.arc(Math.floor(b.attrs.x),Math.floor(b.attrs.y),b.attrs.radius,0,2*Math.PI,u);d.addColorStop(0,"white");d.addColorStop(1,"rgba(255,255,255,0)");a.fillStyle=d;a.fill();a.closePath();a.beginPath();a.arc(b.attrs.x,b.attrs.y,0.65*b.attrs.radius,Math.PI/2,Math.PI,
u);a.lineWidth=2;a.strokeStyle="rgba(255,255,255,0.5)";a.stroke()};return b};Kinetic.Aa=function(b){var c=new Kinetic.Shape(b),d=Math.floor(-5/1024*a.getWidth()),e=Math.floor(7/768*a.getHeight()),f=0.018*a.getWidth(),n=15/1024*a.getWidth();c.drawFunc=function(){c.attrs.v=c.attrs.m+c.attrs.length*Math.sin(c.attrs.i);c.attrs.w=c.attrs.j+c.attrs.length*Math.cos(c.attrs.i);var b=this.getContext(),i=(c.attrs.m+c.attrs.I)/2-20*a.a,j=c.attrs.j-10*a.a,k=(c.attrs.I+i)/2,l=(c.attrs.P+j)/2-5*a.a,h=W.Ma({x:c.attrs.I,
y:c.attrs.P},{x:k,y:l},{x:i,y:j},{x:c.attrs.m,y:c.attrs.j});b.beginPath();b.strokeStyle="brown";b.moveTo(c.attrs.I,c.attrs.P);b.lineTo(h.x,h.y);b.lineTo(c.attrs.m,c.attrs.j);b.lineWidth=c.attrs.strokeWidth/2;b.stroke();b.beginPath();b.moveTo(c.attrs.m,c.attrs.j);b.strokeStyle="brown";b.lineTo(c.attrs.v,c.attrs.w-n-0.2*n);b.stroke();b.beginPath();b.strokeStyle="black";b.moveTo(c.attrs.I,c.attrs.P);b.bezierCurveTo(k,l,i,j,c.attrs.m,c.attrs.j);b.lineWidth=c.attrs.strokeWidth;b.stroke();b.beginPath();
b.arc(Math.floor(c.attrs.v),Math.floor(c.attrs.w)-0.95*n,0.2*n,Math.PI,0,u);b.lineWidth=2;b.strokeStyle="black";b.stroke();i=b.createRadialGradient(c.attrs.v+0.5*n,c.attrs.w-0.5*n,0.1*n,c.attrs.v,c.attrs.w,n);i.addColorStop(0,"#ff6666");i.addColorStop(0.5,"#ff0000");i.addColorStop(1,"#cc0000");b.beginPath();b.arc(Math.floor(c.attrs.v),Math.floor(c.attrs.w),n,0,2*Math.PI,u);b.fillStyle=i;b.fill();b.lineWidth=0.5*c.attrs.strokeWidth;b.strokeStyle="#aa0000";b.stroke();b.font=f+"px Arial";b.fillStyle=
"white";b.fillText(H.g(),Math.floor(c.attrs.v+d),Math.floor(c.attrs.w+e))};return c};this.toString=ba("Fish View");b.on("fishinggame.fishmoved",function(a){var a=a.d,b=J(a);I[a].attrs.x=Math.round(b.x);I[a].attrs.y=Math.round(b.y)},"FishingView");b.on("fishinggame.fishturnedleft",function(a){var b=I[a.d].getScale();I[a.d].setScale(-1*b.x,b.y);va[a.d].setScale(-1*a.d.getScale(),1*a.d.getScale())},"FishingView");b.on("fishinggame.fishturnedright",function(a){var b=I[a.d].getScale();I[a.d].setScale(-1*
b.x,b.y);va[a.d].setScale(1*a.d.getScale(),1*a.d.getScale())},"FishingView");b.on("FishingGame.inactivity",function(a){C.play(a.ta)},"FishingView");b.on("Game.initiate",function(){i()},"FishingView");var ka=this,la=new Kinetic.Layer,aa=new Kinetic.Text({text:"V\u00e4nta...",fontSize:36,fontFamily:"Arial",textFill:"white",x:a.attrs.width/2,y:a.attrs.height/2,align:"center"});la.add(aa);la.J=aa;b.on("Game.roundDone",function(){A.debug("Tearing down view","view");wa.B();e()},"FishingView");b.on("Game.start",
function(){A.debug("Start rolling view...","view");c.c()==O&&1==c.q()?(b.b("Game.showBig",{text:y("MONKEYS_TURN").toUpperCase()}),C.play(Ka),setTimeout(function(){ka.qb(f);T()},3E3)):f()},"FishingView")}X.prototype=new lb;function Ab(b,a,c){function d(b,d,e){var b=new Kinetic.Group({x:b,y:d}),d=new Kinetic.Rect({width:100*a.a,height:100*a.a}),f=new Kinetic.Text({text:e,fontSize:72*a.a,fontFamily:"Arial",textFill:"red",textStroke:"black",textStrokeWidth:2*a.a});b.add(d);b.add(f);b.hc=f;b.J=f;if(c.c()==N||c.c()==L)b.on("mousedown touchstart",function(){k.V(e)});p.add(b);h[e]=b}var f=700*a.a,e=150*a.a,i=100*a.a,m=150*a.a,j={x:200*a.a,y:200*a.a,width:300*a.a,height:500*a.a,stroke:"black",strokeWidth:3*a.a},k=q,l=new Kinetic.Layer,
p=new Kinetic.Layer;a.add(l);a.add(p);var h={};this.K=function(b,c){k=b;A.debug("Setting up FishCountingView","view");var h=new Kinetic.Rect({x:0,y:0,width:a.attrs.width,height:a.attrs.height,fill:"white"});l.add(h);l.draw();h=new Kinetic.Rect(j);p.add(h);for(var n=k.Ya(),t=W.Z(j.x+75*a.a,j.y+100*a.a,135*a.a,135*a.a),h=0;h<n.length;h++)if(n[h]!=g){var v=n[h],F=t.next();c[v].attrs.x=F.x;c[v].attrs.y=F.y;p.add(c[v])}n=[1,2,3,4];t=W.Z(f,e,i,m);for(h=0;h<n.length;h++)F=t.next(),d(F.x,F.y,n[h]);p.draw();
k.c()==N?C.play(xa):(C.play(ya),setTimeout(function(){C.play(Xa["NUMBER_"+k.g()])},700))};this.B=function(){a.remove(p);a.remove(l)};b.on("FishingGame.countingResult",function(a){a.Qa?(C.play(fa),setTimeout(function(){k.Ga()},1500)):C.play(pa)},"FishingView");b.on("FishingGame.counted",function(a){for(var b in h)h[b].J.attrs.textFill="red";h[a.qa].J.attrs.textFill="yellow";setTimeout(function(){h[a.qa].J.attrs.textFill="red";p.draw()},1500);p.draw()},"FishingView")};function lb(){function b(a){s++;3==s&&(a(),d.draw(),c.n("GameView"))}function a(a){C.play(Ma);c.on("frame",function(){d.draw()},"GameView");Tween.get(j.attrs).to(B,2E3).call(function(){b(a)});Tween.get(e.attrs).to(h,2E3).call(function(){b(a)});Tween.get(i.attrs).to(p,2E3).call(function(){b(a)})}var c=new kb,d=new Kinetic.Layer,f=q,e=q,i=q,m=q,j=q,k=q,l=q,p=q,h=q,B=q,r=q,s=0;this.Ab=function(a){c=a};this.Db=function(a){d=a};this.qb=function(b){a(b)};this.La=function(a){s=0;var b=d.getStage();k={x:20,
y:20,width:220,height:730,fill:"white",alpha:0.2};l={x:260,y:20,width:740,height:730,fill:"white",alpha:0.8};p={y:l.y,alpha:0.2,x:l.x+520,width:220,height:l.height,fill:l.fill};h={alpha:0.8,width:740,y:k.y,x:k.x,height:k.height,fill:k.fill};B={x:740+k.x-175,y:540};r={x:60,y:540};W.f(k,b.a);W.f(l,b.a);W.f(p,b.a);W.f(h,b.a);W.f(B,b.a);W.f(r,b.a);b=d.getStage();f=new Kinetic.Rect({x:0,y:0,width:b.getWidth(),height:b.getHeight()});d.add(f);if(a.c()==L||a.c()==O){var b=d.getStage(),c=a.c(),F=c==O&&1<a.q()?
B:r;e=new Kinetic.Rect(c==O&&1<a.q()?h:k);j=new Kinetic.Image({x:F.x,y:F.y,scale:{x:1*b.a,y:1*b.a},width:D.monkey.width,height:D.monkey.height,image:D.monkey});d.add(e);d.add(j)}a.c()==P&&(b=d.getStage(),c=h,c=new Kinetic.Rect({x:c.x,y:c.y,width:c.width,height:c.height,fill:c.fill,alpha:c.alpha}),b=new Kinetic.Image(W.f({x:500,y:450,image:D.rafiki,width:200,height:280},b.a)),d.add(c),d.add(b));b=d.getStage();c=a.c();i=new Kinetic.Rect(c==O&&1<a.q()||c==P?p:l);m=new Kinetic.Image({x:l.x+l.width-210*
b.a,y:l.y+l.height-220*b.a,scale:{x:0.8*b.a,y:0.8*b.a},width:D.avatar.width,height:D.avatar.height,image:D.avatar});d.add(i);d.add(m)}};